<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ul.lst-kix_w26j0skj265t-2{list-style-type:none}ul.lst-kix_w26j0skj265t-1{list-style-type:none}ul.lst-kix_w26j0skj265t-4{list-style-type:none}ul.lst-kix_w26j0skj265t-3{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-1.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-1 0}.lst-kix_kmmb2110z0vd-0>li:before{content:"\0025cf  "}ul.lst-kix_w26j0skj265t-0{list-style-type:none}ol.lst-kix_af8yrnpeup3t-8.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-8 0}.lst-kix_jcbbnz2sleqx-5>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-5}ul.lst-kix_w26j0skj265t-6{list-style-type:none}ul.lst-kix_w26j0skj265t-5{list-style-type:none}ul.lst-kix_kmmb2110z0vd-8{list-style-type:none}ul.lst-kix_w26j0skj265t-8{list-style-type:none}ul.lst-kix_w26j0skj265t-7{list-style-type:none}.lst-kix_kmmb2110z0vd-6>li:before{content:"\0025cf  "}.lst-kix_kmmb2110z0vd-5>li:before{content:"\0025a0  "}.lst-kix_kmmb2110z0vd-4>li:before{content:"\0025cb  "}.lst-kix_kmmb2110z0vd-2>li:before{content:"\0025a0  "}ol.lst-kix_af8yrnpeup3t-2.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-2 0}.lst-kix_kmmb2110z0vd-1>li:before{content:"\0025cb  "}.lst-kix_kmmb2110z0vd-3>li:before{content:"\0025cf  "}ol.lst-kix_j3mmgs9mwad-3.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-3 0}.lst-kix_af8yrnpeup3t-8>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-8}.lst-kix_jcbbnz2sleqx-7>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-7}ol.lst-kix_xhndudf6jcu5-1.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-1 0}.lst-kix_xhndudf6jcu5-7>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-7}ol.lst-kix_jcbbnz2sleqx-7.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-7 0}ul.lst-kix_kmmb2110z0vd-6{list-style-type:none}ul.lst-kix_kmmb2110z0vd-7{list-style-type:none}ul.lst-kix_kmmb2110z0vd-4{list-style-type:none}ul.lst-kix_kmmb2110z0vd-5{list-style-type:none}ul.lst-kix_kmmb2110z0vd-2{list-style-type:none}ul.lst-kix_kmmb2110z0vd-3{list-style-type:none}ul.lst-kix_kmmb2110z0vd-0{list-style-type:none}ul.lst-kix_kmmb2110z0vd-1{list-style-type:none}.lst-kix_af8yrnpeup3t-1>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-1}.lst-kix_j3mmgs9mwad-7>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-7}.lst-kix_jcbbnz2sleqx-3>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-3}.lst-kix_xhndudf6jcu5-0>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-0}ol.lst-kix_af8yrnpeup3t-7.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-7 0}ol.lst-kix_xhndudf6jcu5-2{list-style-type:none}ol.lst-kix_xhndudf6jcu5-1{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-2.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-2 0}ol.lst-kix_xhndudf6jcu5-4{list-style-type:none}ol.lst-kix_xhndudf6jcu5-3{list-style-type:none}ol.lst-kix_xhndudf6jcu5-6{list-style-type:none}ol.lst-kix_xhndudf6jcu5-5{list-style-type:none}ol.lst-kix_xhndudf6jcu5-8{list-style-type:none}ol.lst-kix_xhndudf6jcu5-7{list-style-type:none}ol.lst-kix_xhndudf6jcu5-0{list-style-type:none}ul.lst-kix_mjzqtwb8prrk-6{list-style-type:none}ul.lst-kix_mjzqtwb8prrk-5{list-style-type:none}.lst-kix_jcbbnz2sleqx-5>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-5,lower-roman) ". "}ul.lst-kix_mjzqtwb8prrk-8{list-style-type:none}ul.lst-kix_mjzqtwb8prrk-7{list-style-type:none}.lst-kix_xhndudf6jcu5-5>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-5,lower-roman) ". "}.lst-kix_xhndudf6jcu5-7>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-7,lower-latin) ". "}ul.lst-kix_mjzqtwb8prrk-2{list-style-type:none}ul.lst-kix_mjzqtwb8prrk-1{list-style-type:none}.lst-kix_j3mmgs9mwad-4>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-4}ul.lst-kix_mjzqtwb8prrk-4{list-style-type:none}ul.lst-kix_mjzqtwb8prrk-3{list-style-type:none}.lst-kix_jcbbnz2sleqx-3>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-3,decimal) ". "}ul.lst-kix_mjzqtwb8prrk-0{list-style-type:none}.lst-kix_xhndudf6jcu5-1>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-1,lower-latin) ". "}ol.lst-kix_j3mmgs9mwad-4.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-4 0}.lst-kix_af8yrnpeup3t-4>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-4}.lst-kix_jcbbnz2sleqx-0>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-0}.lst-kix_j3mmgs9mwad-3>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-3}.lst-kix_af8yrnpeup3t-3>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-3}.lst-kix_mjzqtwb8prrk-6>li:before{content:"\0025cf  "}ol.lst-kix_xhndudf6jcu5-5.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-5 0}.lst-kix_jcbbnz2sleqx-1>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-1,lower-latin) ". "}.lst-kix_xhndudf6jcu5-3>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-3,decimal) ". "}.lst-kix_mjzqtwb8prrk-4>li:before{content:"\0025cb  "}.lst-kix_xhndudf6jcu5-4>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-4}.lst-kix_af8yrnpeup3t-2>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-2}.lst-kix_j3mmgs9mwad-2>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-2}ol.lst-kix_xhndudf6jcu5-8.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-8 0}.lst-kix_mjzqtwb8prrk-8>li:before{content:"\0025a0  "}ol.lst-kix_jcbbnz2sleqx-0{list-style-type:none}.lst-kix_jcbbnz2sleqx-2>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-2}ol.lst-kix_jcbbnz2sleqx-0.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-0 0}.lst-kix_jcbbnz2sleqx-7>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-7,lower-latin) ". "}.lst-kix_w26j0skj265t-4>li:before{content:"\0025cb  "}.lst-kix_w26j0skj265t-2>li:before{content:"\0025a0  "}.lst-kix_w26j0skj265t-6>li:before{content:"\0025cf  "}ol.lst-kix_xhndudf6jcu5-7.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-7 0}ol.lst-kix_jcbbnz2sleqx-8{list-style-type:none}.lst-kix_jcbbnz2sleqx-8>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-8}ol.lst-kix_jcbbnz2sleqx-7{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-6{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-5{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-4{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-3{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-2{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-1{list-style-type:none}.lst-kix_w26j0skj265t-8>li:before{content:"\0025a0  "}ol.lst-kix_j3mmgs9mwad-2.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-2 0}.lst-kix_j3mmgs9mwad-5>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-5,lower-roman) ". "}.lst-kix_af8yrnpeup3t-0>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-0,decimal) ". "}.lst-kix_jcbbnz2sleqx-1>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-1}.lst-kix_j3mmgs9mwad-7>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-7,lower-latin) ". "}.lst-kix_af8yrnpeup3t-4>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-4,lower-latin) ". "}.lst-kix_af8yrnpeup3t-2>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-2,lower-roman) ". "}.lst-kix_af8yrnpeup3t-8>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-8,lower-roman) ". "}ol.lst-kix_j3mmgs9mwad-1.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-1 0}.lst-kix_kmmb2110z0vd-8>li:before{content:"\0025a0  "}.lst-kix_af8yrnpeup3t-6>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-6,decimal) ". "}.lst-kix_xhndudf6jcu5-5>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-5}ol.lst-kix_xhndudf6jcu5-6.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-6 0}ol.lst-kix_af8yrnpeup3t-5.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-5 0}ol.lst-kix_j3mmgs9mwad-0.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-0 0}ol.lst-kix_jcbbnz2sleqx-4.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-4 0}.lst-kix_jcbbnz2sleqx-4>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-4}.lst-kix_j3mmgs9mwad-8>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-8}.lst-kix_j3mmgs9mwad-4>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-4,lower-latin) ". "}ol.lst-kix_j3mmgs9mwad-2{list-style-type:none}ol.lst-kix_j3mmgs9mwad-3{list-style-type:none}ol.lst-kix_j3mmgs9mwad-4{list-style-type:none}.lst-kix_j3mmgs9mwad-3>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-3,decimal) ". "}ol.lst-kix_j3mmgs9mwad-5{list-style-type:none}ol.lst-kix_j3mmgs9mwad-6{list-style-type:none}ol.lst-kix_j3mmgs9mwad-7{list-style-type:none}ol.lst-kix_j3mmgs9mwad-8{list-style-type:none}ol.lst-kix_xhndudf6jcu5-4.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-4 0}.lst-kix_j3mmgs9mwad-2>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-2,lower-roman) ". "}.lst-kix_j3mmgs9mwad-1>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-1,lower-latin) ". "}.lst-kix_j3mmgs9mwad-0>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-0,decimal) ". "}.lst-kix_w26j0skj265t-0>li:before{content:"\0025cf  "}.lst-kix_w26j0skj265t-1>li:before{content:"\0025cb  "}ol.lst-kix_j3mmgs9mwad-6.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-6 0}.lst-kix_xhndudf6jcu5-6>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-6}ol.lst-kix_jcbbnz2sleqx-3.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-3 0}ol.lst-kix_af8yrnpeup3t-0.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-0 0}.lst-kix_af8yrnpeup3t-7>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-7}ol.lst-kix_j3mmgs9mwad-5.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-5 0}.lst-kix_mjzqtwb8prrk-1>li:before{content:"\0025cb  "}.lst-kix_mjzqtwb8prrk-3>li:before{content:"\0025cf  "}.lst-kix_mjzqtwb8prrk-2>li:before{content:"\0025a0  "}.lst-kix_mjzqtwb8prrk-0>li:before{content:"\0025cf  "}ol.lst-kix_af8yrnpeup3t-6.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-6 0}.lst-kix_jcbbnz2sleqx-6>li{counter-increment:lst-ctn-kix_jcbbnz2sleqx-6}ol.lst-kix_xhndudf6jcu5-3.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-3 0}.lst-kix_j3mmgs9mwad-1>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-1}.lst-kix_jcbbnz2sleqx-6>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-6,decimal) ". "}ol.lst-kix_af8yrnpeup3t-4{list-style-type:none}ol.lst-kix_af8yrnpeup3t-5{list-style-type:none}ol.lst-kix_af8yrnpeup3t-6{list-style-type:none}ol.lst-kix_af8yrnpeup3t-7{list-style-type:none}ol.lst-kix_af8yrnpeup3t-8{list-style-type:none}ol.lst-kix_jcbbnz2sleqx-8.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-8 0}.lst-kix_xhndudf6jcu5-6>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-6,decimal) ". "}.lst-kix_jcbbnz2sleqx-2>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-2,lower-roman) ". "}.lst-kix_jcbbnz2sleqx-4>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-4,lower-latin) ". "}.lst-kix_xhndudf6jcu5-0>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-0,decimal) ". "}.lst-kix_xhndudf6jcu5-8>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-8,lower-roman) ". "}.lst-kix_mjzqtwb8prrk-7>li:before{content:"\0025cb  "}ol.lst-kix_j3mmgs9mwad-7.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-7 0}.lst-kix_xhndudf6jcu5-2>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-2,lower-roman) ". "}.lst-kix_mjzqtwb8prrk-5>li:before{content:"\0025a0  "}ol.lst-kix_xhndudf6jcu5-2.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-2 0}.lst-kix_xhndudf6jcu5-3>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-3}.lst-kix_jcbbnz2sleqx-0>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-0,decimal) ". "}ol.lst-kix_af8yrnpeup3t-0{list-style-type:none}ol.lst-kix_af8yrnpeup3t-1{list-style-type:none}ol.lst-kix_af8yrnpeup3t-2{list-style-type:none}ol.lst-kix_af8yrnpeup3t-3{list-style-type:none}.lst-kix_xhndudf6jcu5-4>li:before{content:"" counter(lst-ctn-kix_xhndudf6jcu5-4,lower-latin) ". "}.lst-kix_af8yrnpeup3t-5>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-5}ol.lst-kix_af8yrnpeup3t-4.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-4 0}.lst-kix_xhndudf6jcu5-1>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-1}.lst-kix_j3mmgs9mwad-5>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-5}ol.lst-kix_af8yrnpeup3t-1.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-1 0}.lst-kix_jcbbnz2sleqx-8>li:before{content:"" counter(lst-ctn-kix_jcbbnz2sleqx-8,lower-roman) ". "}ol.lst-kix_af8yrnpeup3t-3.start{counter-reset:lst-ctn-kix_af8yrnpeup3t-3 0}.lst-kix_w26j0skj265t-3>li:before{content:"\0025cf  "}.lst-kix_w26j0skj265t-5>li:before{content:"\0025a0  "}ol.lst-kix_xhndudf6jcu5-0.start{counter-reset:lst-ctn-kix_xhndudf6jcu5-0 0}ol.lst-kix_jcbbnz2sleqx-6.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-6 0}.lst-kix_j3mmgs9mwad-6>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-6}.lst-kix_j3mmgs9mwad-0>li{counter-increment:lst-ctn-kix_j3mmgs9mwad-0}.lst-kix_af8yrnpeup3t-6>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-6}ol.lst-kix_j3mmgs9mwad-0{list-style-type:none}ol.lst-kix_j3mmgs9mwad-1{list-style-type:none}.lst-kix_w26j0skj265t-7>li:before{content:"\0025cb  "}.lst-kix_af8yrnpeup3t-0>li{counter-increment:lst-ctn-kix_af8yrnpeup3t-0}.lst-kix_j3mmgs9mwad-6>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-6,decimal) ". "}.lst-kix_af8yrnpeup3t-1>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-1,lower-latin) ". "}.lst-kix_j3mmgs9mwad-8>li:before{content:"" counter(lst-ctn-kix_j3mmgs9mwad-8,lower-roman) ". "}ol.lst-kix_j3mmgs9mwad-8.start{counter-reset:lst-ctn-kix_j3mmgs9mwad-8 0}.lst-kix_af8yrnpeup3t-3>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-3,decimal) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ol.lst-kix_jcbbnz2sleqx-5.start{counter-reset:lst-ctn-kix_jcbbnz2sleqx-5 0}.lst-kix_af8yrnpeup3t-7>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-7,lower-latin) ". "}.lst-kix_xhndudf6jcu5-2>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-2}.lst-kix_kmmb2110z0vd-7>li:before{content:"\0025cb  "}.lst-kix_af8yrnpeup3t-5>li:before{content:"" counter(lst-ctn-kix_af8yrnpeup3t-5,lower-roman) ". "}.lst-kix_xhndudf6jcu5-8>li{counter-increment:lst-ctn-kix_xhndudf6jcu5-8}ol{margin:0;padding:0}table td,table th{padding:0}.c0{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c34{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c13{border-right-style:solid;padding-top:6pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.125;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c14{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-top-style:solid;background-color:#ffffff;margin-left:54pt;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c19{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:128.2pt;border-top-color:#000000;border-bottom-style:solid}.c41{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:88.5pt;border-top-color:#000000;border-bottom-style:solid}.c25{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:208.5pt;border-top-color:#000000;border-bottom-style:solid}.c43{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:208.5pt;border-top-color:#000000;border-bottom-style:solid}.c28{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:88.5pt;border-top-color:#000000;border-bottom-style:solid}.c42{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:128.2pt;border-top-color:#000000;border-bottom-style:solid}.c26{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c23{-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Times New Roman";font-style:italic}.c8{background-color:#ffffff;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c12{background-color:#ffffff;color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:40.5pt;font-family:"Times New Roman";font-style:normal}.c45{-webkit-text-decoration-skip:none;color:#d3002d;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman"}.c1{color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c33{padding-top:24pt;padding-bottom:24pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c21{padding-top:24pt;padding-bottom:42pt;line-height:1.75;orphans:2;widows:2;text-align:left}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c16{padding-top:18pt;padding-bottom:18pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c31{background-color:#ffffff;color:#3d3b49;font-weight:400;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c4{background-color:#ffffff;font-size:12pt;font-family:"Courier New";color:#188038;font-weight:400}.c24{background-color:#eef2f6;color:#188038;font-weight:400;font-size:12pt;font-family:"Courier New"}.c2{background-color:#ffffff;font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:400}.c17{background-color:#ffffff;font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:700}.c3{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:400}.c37{background-color:#000000;color:#ffffff;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c27{background-color:#eef2f6;color:#3d3b49;font-weight:700;font-size:12pt;font-family:"Courier New"}.c7{font-size:12pt;font-family:"Times New Roman";font-style:italic;color:#3d3b49;font-weight:400}.c35{color:#3d3b49;font-weight:700;font-size:14.5pt;font-family:"Times New Roman"}.c10{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:400}.c39{color:#3d3b49;font-weight:700;font-size:54pt;font-family:"Times New Roman"}.c30{color:#3d3b49;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c32{color:#000000;font-weight:400;font-size:11pt;font-family:"Arial"}.c29{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:700}.c46{border-spacing:0;border-collapse:collapse;margin-right:auto}.c40{font-size:12pt;color:#3d3b49;font-weight:700}.c36{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c20{text-decoration:none;vertical-align:baseline;font-style:normal}.c22{text-decoration:none;vertical-align:baseline}.c9{padding:0;margin:0}.c15{color:inherit;text-decoration:inherit}.c18{height:11pt}.c11{text-indent:12pt}.c38{background-color:#ffffff}.c44{height:63pt}.c5{height:42pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c36 doc-content"><h1 class="c34" id="h.8stld7mqkeja"><span class="c20 c38 c39">12</span></h1><h1 class="c34" id="h.8stld7mqkeja-1"><span class="c12">INJECTION</span></h1><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 610.67px; height: 800.00px;"><img alt="" src="images/image7.png" style="width: 610.67px; height: 800.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1">This chapter guides you through the detection and exploitation of several prominent injection vulnerabilities. API requests that are vulnerable to injection allow you to send input that is then directly executed by the API&rsquo;s supporting technologies (such as the web application, database, or operating system running on the server), bypassing input validation measures.</span></p><p class="c0 c11"><span class="c1">You&rsquo;ll typically find injection attacks named after the technology they are targeting. Database injection techniques such as SQL injection take advantage of SQL databases, whereas NoSQL injection takes advantage of NoSQL databases. Cross-site scripting (XSS) attacks insert scripts into web pages that run on a user&rsquo;s browser. Cross-API scripting (XAS) is similar to XSS but leverages third-party applications ingested by the API you&rsquo;re attacking. Command injection is an attack against the web server operating system that allows you to send it operating system commands.</span></p><p class="c0 c11"><span class="c1">The techniques demonstrated throughout this chapter can be applied to other injection attacks as well. As one of the most severe findings you might come across, API injection can lead to a total compromise of a target&rsquo;s most sensitive data or even grant you access to the supporting infrastructure.</span></p><h2 class="c34 c38" id="h.km5gylorfah3"><span class="c30 c20">Discovering Injection Vulnerabilities</span></h2><p class="c0"><span class="c1">Before you can inject a payload using an API, you must discover places where the API accepts user input. One way to discover these injection points is by fuzzing and then analyzing the responses you receive. You should attempt injection attacks against all potential inputs and especially within the following:</span></p><ul class="c9 lst-kix_mjzqtwb8prrk-0 start"><li class="c14 li-bullet-0"><span class="c1">API keys</span></li><li class="c14 li-bullet-0"><span class="c1">Tokens</span></li><li class="c14 li-bullet-0"><span class="c1">Headers</span></li><li class="c14 li-bullet-0"><span class="c1">Query strings in the URL</span></li><li class="c14 li-bullet-0"><span class="c1">Parameters in POST/PUT requests</span></li></ul><p class="c0 c11"><span class="c1">Your approach to fuzzing will depend on how much information you know about your target. If you&rsquo;re not worried about making noise, you could send a variety of fuzzing inputs likely to cause an issue in many possible supporting technologies. Yet the more you know about the API, the better your attacks will be. If you know what database the application uses, what operating system is running on the web server, or the programming language in which the app was written, you&rsquo;ll be able to submit targeted payloads aimed at detecting vulnerabilities in those particular technologies.</span></p><p class="c0 c11"><span class="c1">After sending your fuzzing requests, hunt for responses that contain a verbose error message or some other failure to properly handle the request. In particular, look for any indication that your payload bypassed security controls and was interpreted as a command, either at the operating system, programming, or database level. This response could be as obvious as a message such as &ldquo;SQL Syntax Error&rdquo; or something as subtle as taking a little more time to process a request. You could even get lucky and receive an entire verbose error dump that can provide you with plenty of details about the host.</span></p><p class="c0 c11"><span class="c10">When you do come across a vulnerability, make sure to test every similar endpoint for that vulnerability. Chances are, if you find a weakness in the </span><span class="c7">/file/upload</span><span class="c10">&nbsp;endpoint, all endpoints with an upload feature, such as </span><span class="c7">/image/upload</span><span class="c10">&nbsp;and </span><span class="c7">/account/upload</span><span class="c1">, have the same problem.</span></p><p class="c0 c11"><span class="c1">Lastly, it is important to note that several of these injection attacks have been around for decades. The only thing unique about API injection is that the API provides a newer delivery method for the attack. Since injection vulnerabilities are well known and often have a detrimental impact on application security, they are often well-protected against.</span></p><h2 class="c34 c38" id="h.uxo6egdtn9dl"><span class="c30 c20">Cross-Site Scripting (XSS)</span></h2><p class="c0"><span class="c1">XSS is a classic web application vulnerability that has been around for decades. If you&rsquo;re already familiar with the attack, you might be wondering, is XSS a relevant threat to API security? Of course it is, especially if the data submitted over the API interacts with the web application in the browser.</span></p><p class="c0 c11"><span class="c1">In an XSS attack, the attacker inserts a malicious script into a website by submitting user input that gets interpreted as JavaScript or HTML by a user&rsquo;s browser. Often, XSS attacks inject a pop-up message into a web page that instructs a user to click a link that redirects them to the attacker&rsquo;s malicious content.</span></p><p class="c0 c11"><span class="c1">In a web application, executing an XSS attack normally consists of injecting XSS payloads into different input fields on the site. When it comes to testing APIs for XSS, your goal is to find an endpoint that allows you to submit requests that interact with the frontend web application. If the application doesn&rsquo;t sanitize the request&rsquo;s input, the XSS payload might execute the next time a user visits the application&rsquo;s page.</span></p><p class="c0 c11"><span class="c1">That said, for this attack to succeed, the stars have to align. Because XSS has been around for quite some time, API defenders are quick to eliminate opportunities to easily take advantage of this weakness. In addition, XSS takes advantage of web browsers loading client-side scripts, so if an API does not interact with a web browser, the chances of exploiting this vulnerability are slim to none.</span></p><p class="c0 c11"><span class="c1">Here are a few examples of XSS payloads:</span></p><ol class="c9 lst-kix_xhndudf6jcu5-0 start" start="1"><li class="c14 li-bullet-0"><span class="c24 c20">&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&lt;script&gt;alert(1);&lt;/script&gt;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&lt;%00script&gt;alert(1)&lt;/%00script&gt;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">SCRIPT&gt;alert(&quot;XSS&quot;);///SCRIPT&gt;</span></li></ol><p class="c0 c11"><span class="c10">Each of these scripts attempts to launch an alert in a browser. The variations between the payloads are attempts to bypass user input validation. Typically, a web application will try to prevent XSS attacks by filtering out different characters or preventing characters from being sent in the first place. Sometimes, doing something simple such as adding a null byte (</span><span class="c24">%00</span><span class="c1">) or capitalizing different letters will bypass web app protections. We will go into more depth about evading security controls in Chapter 13.</span></p><p class="c0 c11"><span class="c1">For API-specific XSS payloads, I highly recommend the following resources:</span></p><ol class="c9 lst-kix_j3mmgs9mwad-0 start" start="1"><li class="c14 li-bullet-0"><span class="c29">Payload Box XSS payload list</span><span class="c10">&nbsp;This list contains over 2,700 XSS scripts that could trigger a successful XSS attack (</span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://github.com/payloadbox/xss-payload-list&amp;sa=D&amp;source=editors&amp;ust=1681144503939566&amp;usg=AOvVaw3zrD8R_ElxqVEDZ5Y1L5kB">https://github.com/payloadbox/xss-payload-list</a></span><span class="c1">).</span></li><li class="c14 li-bullet-0"><span class="c29">Wfuzz wordlist</span><span class="c10">&nbsp;A shorter wordlist included with one of our primary tools. Useful for a quick check for XSS (</span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://github.com/xmendez/wfuzz/tree/master/wordlist&amp;sa=D&amp;source=editors&amp;ust=1681144503940103&amp;usg=AOvVaw3zIYJL_UHTrNhz7W8OeP7A">https://github.com/xmendez/wfuzz/tree/master/wordlist</a></span><span class="c1">).</span></li><li class="c14 li-bullet-0"><span class="c29">NetSec.expert XSS payloads</span><span class="c10">&nbsp;Contains explanations of different XSS payloads and their use cases. Useful to better understand each payload and conduct more precise attacks (</span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://netsec.expert/posts/xss-in-2020&amp;sa=D&amp;source=editors&amp;ust=1681144503940765&amp;usg=AOvVaw0UrBrX3FuvqkavJ3oLIhix">https://netsec.expert/posts/xss-in-2020</a></span><span class="c1">).</span></li></ol><p class="c0 c11"><span class="c1">If the API implements some form of security, many of your XSS attempts should produce similar results, like 405 Bad Input or 400 Bad Request. However, watch closely for the outliers. If you find requests that result in some form of successful response, try refreshing the relevant web page in your browser to see whether the XSS attempt affected it.</span></p><p class="c0 c11"><span class="c1">When reviewing the web apps for potential API XSS injection points, look for requests that include client input and are used to display information within the web app. A request used for any of the following is a prime candidate:</span></p><ul class="c9 lst-kix_kmmb2110z0vd-0 start"><li class="c14 li-bullet-0"><span class="c1">Updating user profile information</span></li><li class="c14 li-bullet-0"><span class="c1">Updating social media &ldquo;like&rdquo; information</span></li><li class="c14 li-bullet-0"><span class="c1">Updating ecommerce store products</span></li><li class="c14 li-bullet-0"><span class="c1">Posting to forums or comment sections</span></li></ul><p class="c0 c11"><span class="c1">Search the web application for requests and then fuzz them with an XSS payload. Review the results for anomalous or successful status codes.</span></p><h2 class="c34 c38" id="h.breovrz0nv5n"><span class="c20 c30">Cross-API Scripting (XAS)</span></h2><p class="c0"><span class="c1">XAS is cross-site scripting performed across APIs. For example, imagine that the hAPI Hacking blog has a sidebar powered by a LinkedIn newsfeed. The blog has an API connection to LinkedIn such that when a new post is added to the LinkedIn newsfeed, it appears in the blog sidebar as well. If the data received from LinkedIn isn&rsquo;t sanitized, there is a chance that an XAS payload added to a LinkedIn newsfeed could be injected into the blog. To test this, you could post a LinkedIn newsfeed update containing an XAS script and check whether it successfully executes on the blog.</span></p><p class="c0 c11"><span class="c1">XAS does have more complexities than XSS, because the web application must meet certain conditions in order for XAS to succeed. The web app must poorly sanitize the data submitted through its own API or a third-party one. The API input must also be injected into the web application in a way that would launch the script. Moreover, if you&rsquo;re attempting to attack your target through a third-party API, you may be limited in the number of requests you can make through its platform.</span></p><p class="c0 c11"><span class="c1">Besides these general challenges, you&rsquo;ll encounter the same challenge inherent to XSS attacks: input validation. The API provider might attempt to prevent certain characters from being submitted through the API. Since XAS is just another form of XSS, you can borrow from the XSS payloads described in the preceding section.</span></p><p class="c0 c11"><span class="c10">In addition to testing third-party APIs for XAS, you might look for the vulnerability in cases when a provider&rsquo;s API adds content or makes changes to its web application. For example, let&rsquo;s say the hAPI Hacking blog allows users to update their user profiles through either a browser or a POST request to the API endpoint </span><span class="c7">/api/profile/update</span><span class="c1">. The hAPI Hacking blog security team may have spent all their time protecting the blog from input provided using the web application, completely overlooking the API as a threat vector. In this situation, you might try sending a typical profile update request containing your payload in one field of POST request:</span></p><p class="c6"><span class="c3 c20">POST /api/profile/update HTTP/1.1</span></p><p class="c6"><span class="c3 c20">Host: hapihackingblog.com</span></p><p class="c6"><span class="c3 c20">Authorization: hAPI.hacker.token</span></p><p class="c6"><span class="c3 c20">Content-Type: application/json</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c6"><span class="c3 c20">{</span></p><p class="c6"><span class="c3 c20">&quot;fname&quot;: &quot;hAPI&quot;,</span></p><p class="c6"><span class="c3 c20">&quot;lname&quot;: &quot;Hacker&quot;,</span></p><p class="c6"><span class="c3">&quot;city&quot;: </span><span class="c27">&quot;&lt;script&gt;alert(&quot;xas&quot;)&lt;/script&gt;&quot;</span></p><p class="c16"><span class="c3 c20">}</span></p><p class="c0 c11"><span class="c1">If the request succeeds, load the web page in a browser to see whether the script executes. If the API implements input validation, the server might issue an HTTP 400 Bad Request response, preventing you from sending scripts as payloads. In that case, try using Burp Suite or Wfuzz to send a large list of XAS/XSS scripts in an attempt to locate some that don&rsquo;t result in a 400 response.</span></p><p class="c0 c11"><span class="c10">Another useful XAS tip is to try altering the </span><span class="c24">Content-Type</span><span class="c1">&nbsp;header to induce the API into accepting an HTML payload to spawn the script:</span></p><p class="c16"><span class="c3 c20">Content-Type: text/html</span></p><p class="c0 c11"><span class="c1">XAS requires a specific situation to be in place in order to be exploitable. That said, API defenders often do a better job at preventing attacks that have been around for over two decades, such as XSS and SQL injection, than newer and more complex attacks like XAS.</span></p><h2 class="c34 c38" id="h.9oo3zucxoxpm"><span class="c30 c20">SQL Injection</span></h2><p class="c0"><span class="c1">One of the most well-known web application vulnerabilities, SQL injection, allows a remote attacker to interact with the application&rsquo;s backend SQL database. With this access, an attacker could obtain or delete sensitive data such as credit card numbers, usernames, passwords, and other gems. In addition, an attacker could leverage SQL database functionality to bypass authentication and even gain system access.</span></p><p class="c0 c11"><span class="c1">This vulnerability has been around for decades, and it seemed to be diminishing before APIs presented a new way to perform injection attacks. Still, API defenders have been keen to detect and prevent SQL injections over APIs. Therefore, these attacks are not likely to succeed. In fact, sending requests that include SQL payloads could arouse the attention of your target&rsquo;s security team or cause your authorization token to be banned.</span></p><p class="c0 c11"><span class="c10">Luckily, you can often detect the presence of a SQL database in less obvious ways. When sending a request, try requesting the unexpected. For example, take a look at the Swagger documentation shown in </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-1&amp;sa=D&amp;source=editors&amp;ust=1681144503945226&amp;usg=AOvVaw1-2x-TJxUxBED0RgOO-02J">Figure 12-1</a></span><span class="c1">&nbsp;for a Pixi endpoint.</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 537.33px; height: 602.67px;"><img alt="screenshot of swagger documentation that contains the following values in the body: id, user, pass, name, is_admin , and account_balance" src="images/image1.png" style="width: 537.33px; height: 602.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-1</span><span class="c31 c22">: Pixi API Swagger documentation</span></p><p class="c0 c11"><span class="c10">As you can see, Pixi is expecting the consumer to provide certain values in the body of a request. The </span><span class="c24">&quot;id&quot;</span><span class="c10">&nbsp;value should be a number, </span><span class="c24">&quot;name&quot;</span><span class="c10">&nbsp;expects a string, and </span><span class="c24">&quot;is_admin&quot;</span><span class="c1">&nbsp;expects a Boolean value such as true or false. Try providing a string where a number is expected, a number where a string is expected, and a number or string where a Boolean value is expected. If an API is expecting a small number, send a large number, and if it expects a small string, send a large one. By requesting the unexpected, you&rsquo;re likely to discover a situation the developers didn&rsquo;t predict, and the database might return an error in the response. These errors are often verbose, revealing sensitive information about the database.</span></p><p class="c0 c11"><span class="c10">When looking for requests to target for database injections, seek out those that allow client input and can be expected to interact with a database. In </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-1&amp;sa=D&amp;source=editors&amp;ust=1681144503946367&amp;usg=AOvVaw3pBnRPGuMuQ4oz-_fuHQEV">Figure 12-1</a></span><span class="c1">, there is a good chance that the collected user information will be stored in a database and that the PUT request allows us to update it. Since there is a probable database interaction, the request is a good candidate to target in a database injection attack. In addition to making obvious requests like this, you should fuzz everything, everywhere, because you might find indications of a database injection weakness in less obvious requests.</span></p><p class="c0 c11"><span class="c1">This section will cover two easy ways to test whether an application is vulnerable to SQL injection: manually submitting metacharacters as input to the API and using an automated solution called SQLmap.</span></p><h3 class="c34 c38" id="h.6ighiy9akvaw"><span class="c35 c20">Manually Submitting Metacharacters</span></h3><p class="c0"><span class="c7">Metacharacters</span><span class="c10">&nbsp;are characters that SQL treats as functions rather than as data. For example, </span><span class="c24">--</span><span class="c1">&nbsp;is a metacharacter that tells the SQL interpreter to ignore the following input because it is a comment. If an API endpoint does not filter SQL syntax from API requests, any SQL queries passed to the database from the API will execute.</span></p><p class="c0 c11"><span class="c1">Here are some SQL metacharacters that can cause some issues:</span></p><p class="c0 c11"><span class="c24 c20">&#39;</span></p><p class="c0 c11"><span class="c24 c20">&#39;&#39;</span></p><p class="c0 c11"><span class="c24 c20">;%00</span></p><p class="c0 c11"><span class="c20 c24">--</span></p><p class="c0 c11"><span class="c24 c20">-- -</span></p><p class="c0 c11"><span class="c24 c20">&quot;&quot;</span></p><p class="c0 c11"><span class="c24 c20">;</span></p><p class="c0 c11"><span class="c24 c20">&#39; OR &#39;1</span></p><p class="c0 c11"><span class="c24 c20">&#39; OR 1 -- -</span></p><p class="c0 c11"><span class="c24 c20">&quot; OR &quot;&quot; = &quot;</span></p><p class="c0 c11"><span class="c24 c20">&quot; OR 1 = 1 -- -</span></p><p class="c0 c11"><span class="c24 c20">&#39; OR &#39;&#39; = &#39;</span></p><p class="c0 c11"><span class="c24 c20">OR 1=1</span></p><p class="c0 c11"><span class="c10">All of these symbols and queries are meant to cause problems for SQL queries. A null byte like </span><span class="c24">;%00</span><span class="c10">&nbsp;could cause a verbose SQL-related error to be sent as a response. The </span><span class="c24">OR 1=1</span><span class="c1">&nbsp;is a conditional statement that literally means &ldquo;or the following statement is true,&rdquo; and it results in a true condition for the given SQL query. Single and double quotes are used in SQL to indicate the beginning and ending of a string, so quotes could cause an error or a unique state. Imagine that the backend is programmed to handle the API authentication process with a SQL query like the following, which is a SQL authentication query that checks for username and password:</span></p><p class="c16"><span class="c3 c20">SELECT * FROM userdb WHERE username = &#39;hAPI_hacker&#39; AND password = &#39;Password1!&#39;</span></p><p class="c0 c11"><span class="c10">The query retrieves the values </span><span class="c24">hAPI_hacker</span><span class="c10">&nbsp;and </span><span class="c24">Password1!</span><span class="c10">&nbsp;from the user input. If, instead of a password, we supplied the API with the value </span><span class="c24">&#39; OR 1=1-- -</span><span class="c1">, the SQL query might instead look like this:</span></p><p class="c16"><span class="c3 c20">SELECT * FROM userdb WHERE username = &#39;hAPI_hacker&#39; OR 1=1-- -</span></p><p class="c0 c11"><span class="c10">This would be interpreted as selecting the user with a true statement and skipping the password requirement, as it has been commented out. The query no longer checks for a password at all, and the user is granted access. The attack can be performed to both the username and password fields. In a SQL query, the dashes (</span><span class="c24">--</span><span class="c1">) represent the beginning of a single-line comment. This turns everything within the following query line into a comment that will not be processed. Single and double quotes can be used to escape the current query to cause an error or to append your own SQL query.</span></p><p class="c0 c11"><span class="c1">The preceding list has been around in many forms for years, and the API defenders are also aware of its existence. Therefore, make sure you attempt various forms of requesting the unexpected.</span></p><h3 class="c34 c38" id="h.kvuvcd714ubl"><span class="c20 c35">SQLmap</span></h3><p class="c0"><span class="c1">One of my favorite ways to automatically test an API for SQL injection is to save a potentially vulnerable request in Burp Suite and then use SQLmap against it. You can discover potential SQL weaknesses by fuzzing all potential inputs in a request and then reviewing the responses for anomalies. In the case of a SQL vulnerability, this anomaly is normally a verbose SQL response like &ldquo;The SQL database is unable to handle your request . . .&rdquo;</span></p><p class="c0 c11"><span class="c1">Once you&rsquo;ve saved the request, launch SQLmap, one of the standard Kali packages that can be run over the command line. Your SQLmap command might look like the following:</span></p><p class="c16"><span class="c3">$ </span><span class="c27">sqlmap -r /home/hapihacker/burprequest1 -p </span><span class="c3 c20">password</span></p><p class="c0 c11"><span class="c10">The </span><span class="c24">-r</span><span class="c10">&nbsp;option lets you specify the path to the saved request. The </span><span class="c24">-p</span><span class="c10">&nbsp;option lets you specify the exact parameters you&rsquo;d like to test for SQL injection. If you do not specify a parameter to attack, SQLmap will attack every parameter, one after another. This is great for performing a thorough attack of a simple request, but a request with many parameters can be fairly time-consuming. SQLmap tests one parameter at a time and tells you when a parameter is unlikely to be vulnerable. To skip a parameter, use the CTRL-C keyboard shortcut to pull up SQLmap&rsquo;s scan options and use the </span><span class="c24">n</span><span class="c1">&nbsp;command to move to the next parameter.</span></p><p class="c0 c11"><span class="c1">When SQLmap indicates that a certain parameter may be injectable, attempt to exploit it. There are two major next steps, and you can choose which to pursue first: dumping every database entry or attempting to gain access to the system. To dump all database entries, use the following:</span></p><p class="c16"><span class="c3">$ </span><span class="c27 c20">sqlmap -r /home/hapihacker/burprequest1 -p vuln-param &ndash;dump-all</span></p><p class="c0 c11"><span class="c10">If you&rsquo;re not interested in dumping the entire database, you could use the </span><span class="c24">--dump</span><span class="c1">&nbsp;command to specify the exact table and columns you would like:</span></p><p class="c16"><span class="c3">$ </span><span class="c27 c20">sqlmap -r /home/hapihacker/burprequest1 -p vuln-param &ndash;dump -T users -C password -D helpdesk</span></p><p class="c0 c11"><span class="c10">This example attempts to dump the </span><span class="c24">password</span><span class="c10">&nbsp;column of the </span><span class="c24">users</span><span class="c10">&nbsp;table within the </span><span class="c24">helpdesk</span><span class="c1">&nbsp;database. When this command executes successfully, SQLmap will display database information on the command line and export the information to a CSV file.</span></p><p class="c0 c11"><span class="c1">Sometimes SQL injection vulnerabilities will allow you to upload a web shell to the server that can then be executed to obtain system access. You could use one of SQLmap&rsquo;s commands to automatically attempt to upload a web shell and execute the shell to grant you with system access:</span></p><p class="c16"><span class="c3">$ </span><span class="c27 c20">sqlmap -r /home/hapihacker/burprequest1 -p vuln-param &ndash;os-shell</span></p><p class="c0 c11"><span class="c1">This command will attempt to leverage the SQL command access within the vulnerable parameter to upload and launch a shell. If successful, this will give you access to an interactive shell with the operating system.</span></p><p class="c0 c11"><span class="c10">Alternatively, you could use the </span><span class="c24">os-pwn</span><span class="c1">&nbsp;option to attempt to gain a shell using Meterpreter or VNC:</span></p><p class="c16"><span class="c3">$ </span><span class="c27 c20">sqlmap -r /home/hapihacker/burprequest1 -p vuln-param &ndash;os-pwn</span></p><p class="c0 c11"><span class="c10">Successful API SQL injections may be few and far between, but if you do find a weakness, the impact can lead to a severe compromise of the database and affected servers. For additional information on SQLmap, check out its documentation at </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://github.com/sqlmapproject/sqlmap%23readme&amp;sa=D&amp;source=editors&amp;ust=1681144503952383&amp;usg=AOvVaw2m3ohTyLHv0SyshUzu_FT1">https://github.com/sqlmapproject/sqlmap#readme</a></span><span class="c1">.</span></p><h2 class="c34 c38" id="h.detlhv3pcunw"><span class="c30 c20">NoSQL Injection</span></h2><p class="c0"><span class="c1">APIs commonly use NoSQL databases due to how well they scale with the architecture designs common among APIs, as discussed in Chapter 1. It may even be more common for you to discover NoSQL databases than SQL databases. Also, NoSQL injection techniques aren&rsquo;t as well known as their structured counterparts. Due to this one small fact, you might be more likely to find NoSQL injections.</span></p><p class="c0 c11"><span class="c10">As you hunt, remember that NoSQL databases do not share as many commonalities as the different SQL databases do. </span><span class="c7">NoSQL</span><span class="c1">&nbsp;is an umbrella term that means the database does not use SQL. Therefore, these databases have unique structures, modes of querying, vulnerabilities, and exploits. Practically speaking, you&rsquo;ll conduct many similar attacks and target similar requests, but your actual payloads will vary.</span></p><p class="c0 c11"><span class="c1">The following are common NoSQL metacharacters you could send in an API call to manipulate the database:</span></p><ol class="c9 lst-kix_jcbbnz2sleqx-0 start" start="1"><li class="c14 li-bullet-0"><span class="c24 c20">$gt</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$gt&quot;:&quot;&quot;}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$gt&quot;:-1}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">$ne</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$ne&quot;:&quot;&quot;}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$ne&quot;:-1}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">$nin</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$nin&quot;:1}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$nin&quot;:[1]}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">|| &#39;1&#39;==&#39;1</span></li><li class="c14 li-bullet-0"><span class="c24 c20">//</span></li><li class="c14 li-bullet-0"><span class="c24 c20">||&#39;a&#39;\\&#39;a</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;||&#39;1&#39;==&#39;1&#39;;//</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;/{}:</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;&quot;\;{}</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;&quot;\/$[].&gt;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">{&quot;$where&quot;: &quot;sleep(1000)&quot;}</span></li></ol><p class="c0 c11"><span class="c10">A note on a few of these NoSQL metacharacters: as we touched on in Chapter 1, </span><span class="c24">$gt</span><span class="c10">&nbsp;is a MongoDB NoSQL query operator that selects documents that are greater than the provided value. The </span><span class="c24">$ne</span><span class="c10">&nbsp;query operator selects documents where the value is not equal to the provided value. The </span><span class="c24">$nin</span><span class="c1">&nbsp;operator is the &ldquo;not in&rdquo; operator, used to select documents where the field value is not within the specified array. Many of the others in the list contain symbols that are meant to cause verbose errors or other interesting behavior, such as bypassing authentication or waiting 10 seconds.</span></p><p class="c0 c11"><span class="c1">Anything out of the ordinary should encourage you to thoroughly test the database. When you send an API authentication request, one possible response for an incorrect password is something like the following, which comes from the Pixi API collection:</span></p><p class="c6"><span class="c3 c20">HTTP/1.1 202 Accepted</span></p><p class="c6"><span class="c3 c20">X-Powered-By: Express</span></p><p class="c6"><span class="c3 c20">Content-Type: application/json; charset=utf-8</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{&quot;message&quot;:&quot;sorry pal, invalid login&quot;}</span></p><p class="c0 c11"><span class="c10">Note that a failed response includes a status code of 202 Accepted and includes a failed login message. Fuzzing the </span><span class="c7">/api/login </span><span class="c10">endpoint with certain symbols results in verbose error messaging. For example, the payload </span><span class="c24">&#39;&quot;\;{}</span><span class="c1">&nbsp;sent as the password parameter might cause the following 400 Bad Request message.</span></p><p class="c6"><span class="c3 c20">HTTP/1.1 400 Bad Request</span></p><p class="c6"><span class="c3 c20">X-Powered-By: Express</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">SyntaxError: Unexpected token ; in JSON at position 54&lt;br&gt; &amp;nbsp; &amp;nbsp;at JSON.parse (&amp;lt;anonymous&amp;gt;)&lt;br&gt; [...]</span></p><p class="c0 c11"><span class="c1">Unfortunately, the error messaging does not indicate anything about the database in use. However, this unique response does indicate that this request has an issue with handling certain types of user input, which could be an indication that it is potentially vulnerable to an injection attack. This is exactly the sort of response that should incite you to focus your testing. Since we have our list of NoSQL payloads, we can set the attack position to the password with our NoSQL strings:</span></p><p class="c6"><span class="c3 c20">POST /login HTTP/1.1</span></p><p class="c6"><span class="c3 c20">Host: 192.168.195.132:8000</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3">user=hapi%40hacker.com&amp;pass=</span><span class="c20 c27">&sect;Password1%21&sect;</span></p><p class="c0 c11"><span class="c10">Since we already have this request saved in our Pixi collection, let&rsquo;s attempt our injection attack with Postman. Sending various requests with the NoSQL fuzzing payloads results in 202 Accepted responses, as seen with other bad password attempts in </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-2&amp;sa=D&amp;source=editors&amp;ust=1681144503957085&amp;usg=AOvVaw0T9PjBfOcPQfjYNY5KcyRG">Figure 12-2</a></span><span class="c1">.</span></p><p class="c0 c11"><span class="c10">As you can see, the payloads with nested NoSQL commands </span><span class="c24">{&quot;$gt&quot;:&quot;&quot;}</span><span class="c10">&nbsp;and </span><span class="c24">{&quot;$ne&quot;:&quot;&quot;}</span><span class="c1">&nbsp;result in successful injection and authentication bypass.</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 436.00px;"><img alt="screenshot of postman that shows successful attempts when using nested nosql commands" src="images/image4.png" style="width: 624.00px; height: 436.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-2</span><span class="c22 c31">: Successful NoSQL injection attack using Postman</span></p><h2 class="c34 c38" id="h.c369y75x89iq"><span class="c30 c20">Operating System Command Injection</span></h2><p class="c0"><span class="c1">Operating system command injection is similar to the other injection attacks we&rsquo;ve covered in this chapter, but instead of, say, database queries, you&rsquo;ll inject a command separator and operating system commands. When you&rsquo;re performing operating system injection, it helps a great deal to know which operating system is running on the target server. Make sure you get the most out of your Nmap scans during reconnaissance in an attempt to glean this information.</span></p><p class="c0 c11"><span class="c1">As with all other injection attacks, you&rsquo;ll begin by finding a potential injection point. Operating system command injection typically requires being able to leverage system commands that the application has access to or escaping the application altogether. Some key places to target include URL query strings, request parameters, and headers, as well as any request that has thrown unique or verbose errors (especially those containing any operating system information) during fuzzing attempts.</span></p><p class="c0 c11"><span class="c10">Characters such as the following all act as </span><span class="c7">command separators</span><span class="c1">, which enable a program to pair multiple commands together on a single line. If a web application is vulnerable, it would allow an attacker to add command separators to an existing command and then follow it with additional operating system commands:</span></p><ol class="c9 lst-kix_af8yrnpeup3t-0 start" start="1"><li class="c14 li-bullet-0"><span class="c24 c20">|</span></li><li class="c14 li-bullet-0"><span class="c24 c20">||</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&amp;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&amp;&amp;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&quot;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">;</span></li><li class="c14 li-bullet-0"><span class="c24 c20">&#39;&quot;</span></li></ol><p class="c0 c11"><span class="c10">If you don&rsquo;t know a target&rsquo;s underlying operating system, put your API fuzzing skills to work by using two payload positions: one for the command separator followed by a second for the operating system command. </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23table12-1&amp;sa=D&amp;source=editors&amp;ust=1681144503959903&amp;usg=AOvVaw0F2vkIjs4z1opK2vIl0jQP">Table 12-1</a></span><span class="c1">&nbsp;is a small list of potential operating system commands to use.</span></p><p class="c13"><span class="c38 c45">Table 12-1</span><span class="c31 c22">: Common Operating System Commands to Use in Injection Attacks</span></p><a id="t.28667ca07011f0f5297f8a3a01af986766da96ae"></a><a id="t.0"></a><table class="c46"><tr class="c5"><td class="c42" colspan="1" rowspan="1"><p class="c21"><span class="c38 c40">Operating system</span></p></td><td class="c41" colspan="1" rowspan="1"><p class="c21"><span class="c40 c38">Command</span></p></td><td class="c43" colspan="1" rowspan="1"><p class="c21"><span class="c40 c38">Description</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21"><span class="c2">Windows</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c24">ipconfig</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Shows the network configuration</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c4">dir</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the contents of a directory</span></p></td></tr><tr class="c44"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c24">ver</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the operating system and version</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c4">echo</span><span class="c17">&nbsp;</span><span class="c4">%CD%</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the current working directory</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c24">whoami</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the current user</span></p></td></tr><tr class="c44"><td class="c19" colspan="1" rowspan="1"><p class="c21"><span class="c2">*nix (Linux and Unix)</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c4">ifconfig</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Shows the network configuration</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c24">ls</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the contents of a directory</span></p></td></tr><tr class="c44"><td class="c19" colspan="1" rowspan="1"><p class="c18 c21"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c4">uname</span><span class="c17">&nbsp;</span><span class="c4">-a</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the operating system and version</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c24">pwd</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the current working directory</span></p></td></tr><tr class="c5"><td class="c19" colspan="1" rowspan="1"><p class="c21 c18"><span class="c8"></span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c21"><span class="c4">whoami</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c21"><span class="c2">Prints the current user</span></p></td></tr></table><p class="c0 c11"><span class="c10">To perform this attack with Wfuzz, you can either manually provide a list of commands or supply them as a wordlist. In the following example, I have saved all my command separators in the file </span><span class="c7">commandsep.txt</span><span class="c10">&nbsp;and operating system commands as </span><span class="c7">os-cmds.txt</span><span class="c1">:</span></p><p class="c16"><span class="c3">$ </span><span class="c27 c20">wfuzz -z file,wordlists/commandsep.txt -z file,wordlists/os-cmds.txt http://vulnerableAPI.com/api/users/query?=WFUZZWFUZ2Z</span></p><p class="c0 c11"><span class="c1">To perform this same attack in Burp Suite, you could leverage an Intruder cluster bomb attack.</span></p><p class="c0 c11"><span class="c10">We set the request to be a login POST request and target the </span><span class="c24">user</span><span class="c1">&nbsp;parameter. Two payload positions have been set to each of our files. Review the results for anomalies, such as responses in the 200s and response lengths that stick out.</span></p><p class="c0 c11"><span class="c10">What you decide to do with your operating system command injection is up to you. You could retrieve SSH keys, the </span><span class="c7">/etc/shadow</span><span class="c1">&nbsp;password file on Linux, and so on. Alternatively, you could escalate or command-inject to a full-blown remote shell. Either way, that is where your API hacking transitions into regular old hacking, and there are plenty of other books on that topic. For additional information, check out the following resources:</span></p><ul class="c9 lst-kix_w26j0skj265t-0 start"><li class="c14 li-bullet-0"><span class="c7">RTFM:</span><span class="c10">&nbsp;</span><span class="c7">Red Team Field Manual</span><span class="c1">&nbsp;(2013) by Ben Clark</span></li><li class="c14 li-bullet-0"><span class="c7">Penetration Testing: A Hands-On Introduction to Hacking</span><span class="c1">&nbsp;(No Starch Press, 2014) by Georgia Weidman</span></li><li class="c14 li-bullet-0"><span class="c7">Ethical Hacking: A Hands-On Introduction to Breaking In</span><span class="c1">&nbsp;(No Starch Press, 2021) by Daniel Graham</span></li><li class="c14 li-bullet-0"><span class="c7">Advanced Penetration Testing: Hacking the World&rsquo;s Most Secure Networks</span><span class="c1">&nbsp;(Wiley, 2017) by Wil Allsop</span></li><li class="c14 li-bullet-0"><span class="c7">Hands-On Hacking</span><span class="c1">&nbsp;(Wiley, 2020) by Jennifer Arcuri and Matthew Hickey</span></li><li class="c14 li-bullet-0"><span class="c7">The Hacker Playbook 3: Practical Guide to Penetration Testing</span><span class="c1">&nbsp;(Secure Planet, 2018) by Peter Kim</span></li><li class="c14 li-bullet-0"><span class="c7">The Shellcoder&rsquo;s Handbook: Discovering and Exploiting Security Holes</span><span class="c1">&nbsp;(Wiley, 2007) by Chris Anley, Felix Lindner, John Heasman, and Gerardo Richarte</span></li></ul><h2 class="c34 c38" id="h.b5cki6fqyyi9"><span class="c30 c20">Summary</span></h2><p class="c0"><span class="c1">In this chapter, we used fuzzing to detect several types of API injection vulnerabilities. Then we reviewed the myriad ways these vulnerabilities can be exploited. In the next chapter, you&rsquo;ll learn how to evade common API security controls.</span></p><h2 class="c34 c38" id="h.9rimcwkv89yc"><span class="c20 c37">Lab #9: Faking Coupons Using NoSQL Injection</span></h2><p class="c0"><span class="c1">It&rsquo;s time to approach the crAPI with our new injection powers. But where to start? Well, one feature we haven&rsquo;t tested yet that accepts client input is the coupon code feature. Now don&rsquo;t roll your eyes&mdash;coupon scamming can be lucrative! Search for Robin Ramirez, Amiko Fountain, and Marilyn Johnson and you&rsquo;ll learn how they made $25 million. The crAPI might just be the next victim of a massive coupon heist.</span></p><p class="c0 c11"><span class="c10">Using the web application as an authenticated user, let&rsquo;s use the </span><span class="c29">Add Coupon</span><span class="c10">&nbsp;button found within the Shop tab. Enter some test data in the coupon code field and then intercept the corresponding request with Burp Suite (see </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-3&amp;sa=D&amp;source=editors&amp;ust=1681144503973820&amp;usg=AOvVaw2DIrjdzzEiJA46E0LlZOWC">Figure 12-3</a></span><span class="c1">).</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 374.67px;"><img alt="screenshot of crapi&rsquo;s enter coupon code pop-up window, in which &ldquo;test!&rdquo; has been typed into the coupon code box and has given the error message &ldquo;invalid coupon code&rdquo;" src="images/image5.png" style="width: 624.00px; height: 374.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-3</span><span class="c31 c22">: The crAPI coupon code validation feature</span></p><p class="c0 c11"><span class="c1">In the web application, using this coupon code validation feature with an incorrect coupon code results in an &ldquo;invalid coupon code&rdquo; response. The intercepted request should look like the following:</span></p><p class="c6"><span class="c3 c20">POST /community/api/v2/coupon/validate-coupon HTTP/1.1</span></p><p class="c6"><span class="c3 c20">Host: 192.168.195.130:8888</span></p><p class="c6"><span class="c3 c20">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6"><span class="c3 c20">Content-Type: application/json</span></p><p class="c6"><span class="c3 c20">Authorization: Bearer Hapi.hacker.token</span></p><p class="c6"><span class="c3 c20">Connection: close</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{&quot;coupon_code&quot;:&quot;TEST!&quot;}</span></p><p class="c0 c11"><span class="c10">Notice the </span><span class="c24">&quot;coupon_code&quot;</span><span class="c10">&nbsp;value in the POST request body. This seems like a good field to test if we&rsquo;re hoping to forge coupons. Let&rsquo;s send the request over to Intruder and add our payload positions around </span><span class="c24">TEST!</span><span class="c1">&nbsp;so we can fuzz this coupon value. Once we&rsquo;ve set our payload positions, we can add our injection fuzzing payloads. Try including all the SQL and NoSQL payloads covered in this chapter. Next, begin the Intruder fuzzing attack.</span></p><p class="c0 c11"><span class="c10">The results of this initial scan all show the same status code (500) and response length (385), as you can see in </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-4&amp;sa=D&amp;source=editors&amp;ust=1681144503975587&amp;usg=AOvVaw1YQJAkv-7Irt6dzW7TML-A">Figure 12-4</a></span><span class="c1">.</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 306.67px;"><img alt="fuzzing results show various requests, all with a length of 385 and a status code of 500" src="images/image3.png" style="width: 624.00px; height: 306.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-4</span><span class="c31 c22">: Intruder fuzzing results</span></p><p class="c0 c11"><span class="c1">Nothing appears anomalous here. Still, we should investigate what the requests and responses look like. See Listings 12-1 and 12-2.</span></p><p class="c6"><span class="c3 c20">POST /community/api/v2/coupon/validate-coupon HTTP/1.1</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{&quot;coupon_code&quot;:&quot;%7b$where%22%3a%22sleep(1000)%22%7d&quot;}</span></p><p class="c0"><span class="c23">Listing 12-1</span><span class="c7 c22">: The coupon validation request</span></p><p class="c6"><span class="c3 c20">HTTP/1.1 500 Internal Server Error</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{}</span></p><p class="c0"><span class="c23">Listing 12-2</span><span class="c7 c22">: The coupon validation response</span></p><p class="c0 c11"><span class="c10">While reviewing the results, you may notice something interesting. Select one of the results and look at the Request tab. Notice that the payload we sent has been encoded. This could be interfering with our injection attack because the encoded data might not be interpreted correctly by the application. In other situations, the payload might need to be encoded to help bypass security controls, but for now, let&rsquo;s find the source of this problem. At the bottom of the Burp Suite Intruder Payloads tab is an option to URL-encode certain characters. Uncheck this box, as shown in </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-5&amp;sa=D&amp;source=editors&amp;ust=1681144503977512&amp;usg=AOvVaw0dBacMBjv3Qs0pYCdP4222">Figure 12-5</a></span><span class="c1">, so that the characters will be sent, and then send another attack.</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 81.33px;"><img alt="screenshot of burp suite&rsquo;s intruder payloads tab that shows the &ldquo;url-encode these characters&rdquo; option as unchecked" src="images/image2.png" style="width: 624.00px; height: 81.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-5</span><span class="c31 c22">: Burp Suite Intruder&rsquo;s payload-encoding options</span></p><p class="c0 c11"><span class="c10">The request should now look like </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23listing12-3&amp;sa=D&amp;source=editors&amp;ust=1681144503978267&amp;usg=AOvVaw10MCd90vgwkw7VnWsrDwvY">Listing 12-3</a></span><span class="c10">, and the response should now look like </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23listing12-4&amp;sa=D&amp;source=editors&amp;ust=1681144503978615&amp;usg=AOvVaw1bO5ilp_2SJWueYGcsnuhG">Listing 12-4</a></span><span class="c1">:</span></p><p class="c6"><span class="c3 c20">POST /community/api/v2/coupon/validate-coupon HTTP/1.1</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{&quot;coupon_code&quot;:&quot;{&quot;$nin&quot;:[1]}&quot;}&quot;</span></p><p class="c0"><span class="c23">Listing 12-3</span><span class="c7 c22">: The request with URL encoding disabled</span></p><p class="c6"><span class="c3 c20">HTTP/1.1 422 Unprocessable Entity</span></p><p class="c6"><span class="c3 c20">--snip--</span></p><p class="c6 c18"><span class="c3 c20"></span></p><p class="c16"><span class="c3 c20">{&quot;error&quot;:&quot;invalid character &#39;$&#39; after object key:value pair&quot;}</span></p><p class="c0"><span class="c23">Listing 12-4</span><span class="c7 c22">: The corresponding response</span></p><p class="c0 c11"><span class="c1">This round of attacks did result in some slightly more interesting responses. Notice the 422 Unprocessable Entity status code, along with the verbose error message. This status code normally means that there is an issue in the syntax of the request.</span></p><p class="c0 c11"><span class="c1">Taking a closer look at our request, you might notice a possible issue: we placed our payload position within the original key/value quotes generated in the web application&rsquo;s request. We should experiment with the payload position to include the quotes so as to not interfere with nested object injection attempts. Now the Intruder payload positions should look like the following:</span></p><p class="c16"><span class="c3 c20">{&quot;coupon_code&quot;:&sect;&quot;TEST!&quot;&sect;}</span></p><p class="c0 c11"><span class="c10">Once again, initiate the updated Intruder attack. This time, we receive even more interesting results, including two 200 status codes (see </span><span class="c23"><a class="c15" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c12.xhtml%23figure12-6&amp;sa=D&amp;source=editors&amp;ust=1681144503980936&amp;usg=AOvVaw1pR1G0Ike7Jpb4Y97cX1jd">Figure 12-6</a></span><span class="c1">).</span></p><p class="c33"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 556.00px; height: 573.33px;"><img alt="screenshot of burp suite&rsquo;s intruder results that shows various requests of varying lengths; all but two requests are of status code 422, and the two are of status code 200." src="images/image6.png" style="width: 556.00px; height: 573.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c13"><span class="c26">Figure 12-6</span><span class="c31 c22">: Burp Suite Intruder results</span></p><p class="c0 c11"><span class="c10">As you can see, two injection payloads, </span><span class="c24">{&quot;$gt&quot;:&quot;&quot;}</span><span class="c10">&nbsp;and </span><span class="c24">{&quot;$nin&quot;:[1]}</span><span class="c10">, resulted in successful responses. By investigating the response to the </span><span class="c24">$nin</span><span class="c1">&nbsp;(not in) NoSQL operator, we see that the API request has returned a valid coupon code. Congratulations on performing a successful API NoSQL injection attack!</span></p><p class="c0 c11"><span class="c1">Sometimes the injection vulnerability is present, but you need to troubleshoot your attack attempts to find the injection point. Therefore, make sure you analyze your requests and responses and follow the clues left within verbose error messages.</span></p><p class="c6 c18"><span class="c20 c32"></span></p></body></html>